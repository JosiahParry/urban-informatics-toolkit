<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 20 Grammer of layered graphics II | Urban Informatics Toolkit</title>
<meta name="author" content="Josiah Parry">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.5.3/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Urban Informatics Toolkit</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome</a></li>
<li class="book-part">Foundations of Urban Informatics</li>
<li><a class="" href="the-utility-and-danger-of-big-data.html"><span class="header-section-number">2</span> The Utility and Danger of Big Data</a></li>
<li><a class="" href="data-in-the-municipal-context.html"><span class="header-section-number">3</span> Data in the municipal context</a></li>
<li><a class="" href="approaches-to-and-schools-of-urban-informatics.html"><span class="header-section-number">4</span> Approaches to and Schools of Urban Informatics</a></li>
<li><a class="" href="ecometrics.html"><span class="header-section-number">5</span> Ecometrics</a></li>
<li class="book-part">Toolkit Foundations</li>
<li><a class="" href="the-basics.html"><span class="header-section-number">6</span> The basics</a></li>
<li><a class="" href="r-as-a-calculator.html"><span class="header-section-number">7</span> R as a calculator</a></li>
<li><a class="" href="reading-data.html"><span class="header-section-number">8</span> Reading data</a></li>
<li><a class="" href="exploratory-visual-analysis.html"><span class="header-section-number">9</span> Exploratory Visual Analysis</a></li>
<li><a class="" href="general-data-manipulation.html"><span class="header-section-number">10</span> General data manipulation</a></li>
<li><a class="" href="thats-too-much-data.html"><span class="header-section-number">11</span> That’s too much data</a></li>
<li><a class="" href="the-pipe.html"><span class="header-section-number">12</span> The pipe %&gt;%</a></li>
<li><a class="" href="creating-new-measures.html"><span class="header-section-number">13</span> Creating new measures</a></li>
<li><a class="" href="data-structures.html"><span class="header-section-number">14</span> Data Structures</a></li>
<li><a class="" href="summary-statistics.html"><span class="header-section-number">15</span> Summary statistics</a></li>
<li><a class="" href="summarizing-the-tidy-way.html"><span class="header-section-number">16</span> Summarizing the tidy way</a></li>
<li><a class="" href="toolkit-review.html"><span class="header-section-number">17</span> Toolkit review</a></li>
<li class="book-part">Vizualization Strategies</li>
<li><a class="" href="layered-i.html"><span class="header-section-number">18</span> Grammar of layered graphics I</a></li>
<li><a class="" href="visualizing-trends-and-relationships.html"><span class="header-section-number">19</span> Visualizing Trends and Relationships</a></li>
<li><a class="active" href="grammer-of-layered-graphics-ii.html"><span class="header-section-number">20</span> Grammer of layered graphics II</a></li>
<li><a class="" href="visualizing-beyond-2-dimensions.html"><span class="header-section-number">21</span> Visualizing beyond 2-dimensions</a></li>
<li><a class="" href="visualizing-through-time.html"><span class="header-section-number">22</span> Visualizing through time</a></li>
<li><a class="" href="visualization-review.html"><span class="header-section-number">23</span> Visualization Review</a></li>
<li class="book-part">Expanding the Toolkit</li>
<li><a class="" href="multiple-data-sets.html"><span class="header-section-number">24</span> Multiple data sets</a></li>
<li><a class="" href="statistics.html"><span class="header-section-number">25</span> Statistics</a></li>
<li><a class="" href="spatial-analysis.html"><span class="header-section-number">26</span> Spatial Analysis</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="grammer-of-layered-graphics-ii" class="section level1" number="20">
<h1>
<span class="header-section-number">20</span> Grammer of layered graphics II<a class="anchor" aria-label="anchor" href="#grammer-of-layered-graphics-ii"><i class="fas fa-link"></i></a>
</h1>
<p>We’ve developed a strong foundation for building charts from the ground up by specifying our <strong>defaults</strong> (data, and aesthetic mappings), and adding geom <strong>layers</strong>. In order to take our charts to the next level we need to familiarize ourselves with the other components of the <em>Layered Grammar of Graphics</em>: scales, coordinates, and facets.</p>
<p>For these examples we will again return to our commute dataset. We will also recreate the two columns <code>hh_inc_quin</code> and <code>edu_attain</code>.</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">commute</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/gba_commute.csv"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>hh_inc_quin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/ranking.html">ntile</a></span><span class="op">(</span><span class="va">med_house_income</span>, <span class="fl">5</span><span class="op">)</span>,
         edu_attain <span class="op">=</span> <span class="va">bach</span> <span class="op">+</span> <span class="va">master</span><span class="op">)</span></code></pre></div>
<div id="scales" class="section level2" number="20.1">
<h2>
<span class="header-section-number">20.1</span> Scales<a class="anchor" aria-label="anchor" href="#scales"><i class="fas fa-link"></i></a>
</h2>
<p>Recall from <em><a href="layered-i.html#layered-i">Grammar of Layered Graphics I</a></em> that when we supply our aesthetic mappings our axes are filled out automatically.</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">commute</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">med_house_income</span>, <span class="va">bach</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04c-grammar-II_files/figure-html/unnamed-chunk-4-1.png" width="100%"></div>
<p>By specifying our defaults in the <code><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot()</a></code> call, we implicitly are providing the x and y axes. From those mappings, ggplot2 is able to identify the type of variable mapped to each aesthetic and its values. That inference makes it possible for us to plot without having to explicitly state what our axes are.</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">commute</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">med_house_income</span>, <span class="va">bach</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<p>In the above chart, each column is being mapped as a continuous variable. We are able to manually specify what each scale type is by using the various <code>scale_*_type()</code> layers from ggplot2. These layers follow a general format of first specifying <code>scale</code> followed by which aesthetic we’re scaling, and what data type. For example, to change the <code>med_house_income</code> axis to a discrete axis we can apply the layer <code><a href="https://rdrr.io/pkg/ggplot2/man/scale_discrete.html">scale_x_discrete()</a></code></p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span><span class="op">)</span> 
<span class="co">#&gt; Warning: Removed 8 rows containing missing values (geom_point).</span></code></pre></div>
<div class="inline-figure"><img src="04c-grammar-II_files/figure-html/unnamed-chunk-6-1.png" width="100%"></div>
<p>In doing so we have lost the axis labels! That is because ggplot2 considers both integers and floating point (numbers with decimals) as continuous and categorical variables as being discrete.</p>
<p>Nonetheless, we have a lot of functions at our disposal to alter the axes to our liking!</p>
<div id="transformations" class="section level3" number="20.1.1">
<h3>
<span class="header-section-number">20.1.1</span> Transformations<a class="anchor" aria-label="anchor" href="#transformations"><i class="fas fa-link"></i></a>
</h3>
<p>In our data exploration, we will come across non-normal distributions of data. For example income is almost always right skewed and displays some sort of log-normal-ish behavior. We may not want to actually change to underlying values of that variable, but want to apply transformations for the purposes of visualization. In those cases, we can apply scale transformations.</p>
<p>As an example, in our visualization of income and education there is a slight right skew to <code>med_house_income</code>. The graphic doesn’t justify a logarithmic transformation, but may benefit from a sqrt transformation. We can apply this with <code><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_x_sqrt()</a></code>.</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_x_sqrt</a></span><span class="op">(</span><span class="op">)</span> 
<span class="co">#&gt; Warning: Removed 8 rows containing missing values (geom_point).</span></code></pre></div>
<div class="inline-figure"><img src="04c-grammar-II_files/figure-html/unnamed-chunk-7-1.png" width="100%"></div>
<p>We can apply a log10 transformation as well with <code>scale_*_log10()</code>.</p>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> 
<span class="co">#&gt; Warning: Removed 8 rows containing missing values (geom_point).</span></code></pre></div>
<div class="inline-figure"><img src="04c-grammar-II_files/figure-html/unnamed-chunk-8-1.png" width="100%"></div>
<p>This is an overcorrection. The slight upward arch in the original plotting is now inverted. Nonetheless, I hope the point is made.</p>
<p>In addition to applying transformations, we will want to have more control over the limits of our graph. For example, say we want to have our y axis include all <em>possible</em> values of [0,1]. We can tell ggplot what range of values we want our axes to contain with <code><a href="https://rdrr.io/pkg/ggplot2/man/lims.html">lims()</a></code>. <code><a href="https://rdrr.io/pkg/ggplot2/man/lims.html">lims()</a></code> takes a name-value pair where the name is an aesthetic and the value is a numeric vector with two elements—the first being the value at the origin and the second being at the extent of the axis<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://ggplot2.tidyverse.org/reference/lims" class="uri"&gt;https://ggplot2.tidyverse.org/reference/lims&lt;/a&gt;&lt;/p&gt;'><sup>64</sup></a>.</p>
<blockquote>
<p>Note: [0,1] means from 0 inclusive to 1 inclusive.</p>
</blockquote>
<p>We can modify our y axis to have the limits of [0,1] by adding a <code><a href="https://rdrr.io/pkg/ggplot2/man/lims.html">lims()</a></code> layer where we set the <code>y</code> aesthetic to <code><a href="https://rdrr.io/r/base/c.html">c(0, 1)</a></code>.</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/lims.html">lims</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 8 rows containing missing values (geom_point).</span></code></pre></div>
<div class="inline-figure"><img src="04c-grammar-II_files/figure-html/unnamed-chunk-9-1.png" width="100%"></div>
<p>The graph we get we when expand our y axis limits definitely contains a bit too much white space. But by expanding ths grid, we can see this sort of flattening out of education at around $150,000 while income still continues to increase. Perhaps if we omit tose values, the relationship may seem even stronger. Let’s experiment with that.</p>
<ul>
<li>Set the x axis limit to be from [0, 150000]</li>
<li>Set the y axis limits to be from [0, 0.5]</li>
</ul>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/lims.html">lims</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">150000</span><span class="op">)</span>,
    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.5</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04c-grammar-II_files/figure-html/unnamed-chunk-10-1.png" width="100%"></div>
<p>By changing the extent of our axes this relationship seems much more robust! Such a visualization could spur further validation of this ACS data.</p>
<blockquote>
<p>Remember, ACS data come from samples and sometimes those samples are small. Because of these small sample sizes, we may very well get values that are not properly representative. It is on you to decide whether or not you should include or exclude the values!</p>
</blockquote>
</div>
<div id="labeling" class="section level3" number="20.1.2">
<h3>
<span class="header-section-number">20.1.2</span> Labeling<a class="anchor" aria-label="anchor" href="#labeling"><i class="fas fa-link"></i></a>
</h3>
<p>The plots we create, while lovely as they are, are somewhat lacking in the labeling department. I would put money on it that no publication would accept plots with labels such as the ones above for sole reason being that our axes titles and scale labels are hard to interpret.</p>
<p>We’ve already used it befofe but to be extra clear, to add titles and axis labels to our plots (not adjusting the scale labels) we use a <code><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs()</a></code> layer. With <code><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs()</a></code>, you can label any aesthetic you have mapped as well as adding a <code>title</code>, <code>subtitle</code>, <code>caption</code>, and a <code>tag</code>.</p>
<p>Let’s add some titles and labels to our plot.</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">commute</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">med_house_income</span>, <span class="va">bach</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>
       y <span class="op">=</span> <span class="st">"% of population with a Bachelor's Degree"</span>,
       x <span class="op">=</span> <span class="st">"Median Household Income"</span>,
       title <span class="op">=</span> <span class="st">"Relationship between Education and Income"</span>,
       subtitle <span class="op">=</span> <span class="st">"All Massachusetts Tracts"</span>,
       caption <span class="op">=</span> <span class="st">"Source: Boston Area Research Initiative\nvia US Census Bureau"</span>
      <span class="op">)</span>

<span class="va">p</span></code></pre></div>
<div class="inline-figure"><img src="04c-grammar-II_files/figure-html/unnamed-chunk-11-1.png" width="100%"></div>
<p>Friends, it’s looking pretty good. But there are just two more changes we need to make: our axes labels! The x and y axes labels are meant to illustrate dollar amounts and percentages but respectively. To change the <em>scale</em> labels. we will use some helper functions from the package <a href="https://scales.r-lib.org/"><code>scales</code></a></p>
<p>{scales} provides handy functions for taking a variable and altering the labeling to match some other format. In our case, we are interested in printing our <code>med_house_income</code> as in a dollar format, i.e. <code>2000</code> becomes <code>\$2,000</code>, and <code>bach</code> as a percentage, i.e. <code>.4</code> becomes <code>%40</code>. To alter our labels we will use <code><a href="https://rdrr.io/pkg/scales/man/label_dollar.html">scales::dollar()</a></code>, and <code><a href="https://rdrr.io/pkg/scales/man/label_percent.html">scales::percent()</a></code> respectively.</p>
<blockquote>
<p>Isn’t it nice how well named functions can be sometimes?</p>
</blockquote>
<p>To produce the examples outlined above we would call the function as such:</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scales/man/label_dollar.html">dollar</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span>
<span class="co">#&gt; [1] "$2,000"</span>
<span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scales/man/label_percent.html">percent</a></span><span class="op">(</span><span class="fl">.4</span><span class="op">)</span>
<span class="co">#&gt; [1] "40%"</span></code></pre></div>
<p>Now we have an understanding of <em>how</em> the function behaves, but where do we actually change the labels? This is where we come full cirlce back to our <code>scale_*_continuous()</code> layer. As we mentioned earlier, <code><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot()</a></code> will handle making the scales for us. But <code><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot()</a></code> doesn’t know how we want to label our variables or how they should appear on the axes. And now the impetus is on us to make these changes manually. To change the axis labels we will specify which axis we are altering using the proper scale layer—i.e. <code>scale_y_</code> or <code>scale_x_</code>. Then, in each layer we set the <code>labels</code> argument to the respective labelling function we want—e.g. <code><a href="https://rdrr.io/pkg/scales/man/label_percent.html">scales::percent</a></code> and <code><a href="https://rdrr.io/pkg/scales/man/label_dollar.html">scales::dollar</a></code>.</p>
<blockquote>
<p>Note: If you append parentheses like you normally would you will get an error. This case we want to ignore them because when they are present, R will try to evaluate that function. Rather, we are interested in providing the <em>function object</em> to the <code>labels</code> argument rather than provide it with a vector of output.</p>
</blockquote>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/scales/man/label_dollar.html">dollar</a></span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/scales/man/label_percent.html">percent</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 8 rows containing missing values (geom_point).</span></code></pre></div>
<div class="inline-figure"><img src="04c-grammar-II_files/figure-html/unnamed-chunk-13-1.png" width="100%"></div>
<p>In addition to being able to control the <strong>defaults</strong>, the <strong>layers</strong>, and now the <strong>scales</strong> you are well equipped to create and manipulate your own plots.</p>
</div>
</div>
<div id="coordinates" class="section level2" number="20.2">
<h2>
<span class="header-section-number">20.2</span> Coordinates<a class="anchor" aria-label="anchor" href="#coordinates"><i class="fas fa-link"></i></a>
</h2>
<p>While you’re likely to create 98% of your visualizations without ever manipulating the coordinates, it is still good knowledge to have!</p>
<p>As we have mentioned and alluded to, we are working in a two-dimensional space—meaning with x and y coordinates. When working in two-dimensions, thee cartesian plane is the natural choice for a coordinate reference system. In all of our plots, this has been the default. Behind the scenes, ggplot is essentially adding a <code><a href="https://rdrr.io/pkg/ggplot2/man/coord_cartesian.html">coord_cartesian()</a></code> layer to your plot.</p>
<blockquote>
<p>Think of this much of the same way that your scales are inferred.</p>
</blockquote>
<p>If, however, we find the need to alter or manipulate the coordinate system the tools are available to us. We’ve actually already used one, <code><a href="https://rdrr.io/pkg/ggplot2/man/coord_flip.html">coord_flip()</a></code>. Like, with scales, all coordinate based functions are prefixed with <code>coord_()</code>. If you will need to use these coordinate layers, it will be to essentially change the aspect ratio of your plots.</p>
<p>We will encounter coordinates much more when we talk about spatial data. For now, though, all you need to know is that they exist and are a major underlying part of your plots.</p>
</div>
<div id="facets" class="section level2" number="20.3">
<h2>
<span class="header-section-number">20.3</span> Facets<a class="anchor" aria-label="anchor" href="#facets"><i class="fas fa-link"></i></a>
</h2>
<p>The last portion of the grammar to visit is facetting. When we facet a plot we are creating what are called “small multiples”, a term coined by the prominent Edward Tufte. A facetting, in other words, creates a graph for each unique level in a categorical variable. Think of this like a <code><a href="https://rdrr.io/pkg/dplyr/man/group_by.html">group_by()</a></code> for plotting.</p>
<p>There are two types of facetting we can do: wrapped and grid. These are done with <code><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap()</a></code> and <code><a href="https://rdrr.io/pkg/ggplot2/man/facet_grid.html">facet_grid()</a></code> respectively. The reference documentation sums up the differences best:</p>
<blockquote>
<p>“<code><a href="https://rdrr.io/pkg/ggplot2/man/facet_grid.html">facet_grid()</a></code> forms a matrix of panels defined by row and column faceting variables. It is most useful when you have two discrete variables, and all combinations of the variables exist in the data. If you have only one variable with many levels, try <code><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap()</a></code>.”<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="uri"&gt;https://ggplot2.tidyverse.org/reference/facet_grid.html&lt;/a&gt;&lt;/p&gt;'><sup>65</sup></a></p>
</blockquote>
<p>Let’s look at <code><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap()</a></code> first. To create the facetting, we need to add <code><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap()</a></code> as a layer to our existing plot. There is only one argument that we are required to fulfill and that is the <code>facet</code> argument. <code>facet</code> expects a set of variables defined by the <code><a href="https://rdrr.io/pkg/dplyr/man/vars.html">vars()</a></code> function. <code><a href="https://rdrr.io/pkg/dplyr/man/vars.html">vars()</a></code> is a function used throughout the tidyverse to specify which columns are to be referenced used within the context of a the function it’s being used in.</p>
<p>To recreate the above plot but facetting by county, we would add <code><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap(vars(county))</a></code> as a layer to our plot.</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">commute</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">hh_inc_quin</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">med_house_income</span>, <span class="va">edu_attain</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> 

<span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/vars.html">vars</a></span><span class="op">(</span><span class="va">county</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04c-grammar-II_files/figure-html/unnamed-chunk-14-1.png" width="100%"></div>
<p>With <code><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap()</a></code> we are able to explicitly state how many rows or columns of plots there should be. The defaults may be nice, but it’s always good to be explicit about our expecvtations! We set the <code>nrow</code> or <code>ncol</code> argument to do this. Since our above example defaulted to <code>ncol = 3</code>, let’s try this with three rows.</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/vars.html">vars</a></span><span class="op">(</span><span class="va">county</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04c-grammar-II_files/figure-html/unnamed-chunk-15-1.png" width="100%"></div>
<p>The grid works a little bit differenly. Rather than specifying which columns to facet on and the number of rows or columns, we can create a grid (or matrix) of small multiples. With <code><a href="https://rdrr.io/pkg/ggplot2/man/facet_grid.html">facet_grid()</a></code> we use the <code>rows</code> and <code>cols</code>.</p>
<p>We can recreate our above graphs by passing <code><a href="https://rdrr.io/pkg/dplyr/man/vars.html">vars(county)</a></code> to either <code>rows</code> or <code>cols</code>. But where <code><a href="https://rdrr.io/pkg/ggplot2/man/facet_grid.html">facet_grid()</a></code> shines is when you have data in every pairing of two categorical variables. For example we can we create a facet for each combination of <code>county</code> and <code>hh_inc_quin</code>.</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_grid.html">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/vars.html">vars</a></span><span class="op">(</span><span class="va">county</span><span class="op">)</span>,
             rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/vars.html">vars</a></span><span class="op">(</span><span class="va">hh_inc_quin</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04c-grammar-II_files/figure-html/unnamed-chunk-16-1.png" width="100%"></div>
<p>When we create facets, each panel has shares the same scales. We can change this by setting the <code>scales</code> argument to one of <code>"free"</code>, <code>"free_x"</code>, or <code>"free_y"</code>. These in essence, “free up” the scales for each panel. We can choose to share the scales on the x axis by setting <code>scales = "free_y"</code> or vice versa.</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_grid.html">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/vars.html">vars</a></span><span class="op">(</span><span class="va">county</span><span class="op">)</span>,
             rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/vars.html">vars</a></span><span class="op">(</span><span class="va">hh_inc_quin</span><span class="op">)</span>,
             scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04c-grammar-II_files/figure-html/unnamed-chunk-17-1.png" width="100%"></div>
<blockquote>
<p>Note: the behavior of <code>scales = "free"</code> changes behavior when set in the context of <code><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap()</a></code> vs <code><a href="https://rdrr.io/pkg/ggplot2/man/facet_grid.html">facet_grid()</a></code>. The former frees the scales for each panel. The latter frees the scales for either a column or row of panels.</p>
</blockquote>
<p>It is also important to note that what we have gone through is by no means exhaustive. You should, at minimum, familiarize yourself with both <code>scale_*_reverse()</code>, and <code>scale_*_binned()</code> in your spare time. There are dozens, if not hundreds, of ggplot2 functions to suit your every whim. And, as you have already briefly seen, the ggplot function universe is not relegated to just ggplot2. There are many other packages which have built custom geoms and other enhancements that may benefit you.</p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="visualizing-trends-and-relationships.html"><span class="header-section-number">19</span> Visualizing Trends and Relationships</a></div>
<div class="next"><a href="visualizing-beyond-2-dimensions.html"><span class="header-section-number">21</span> Visualizing beyond 2-dimensions</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#grammer-of-layered-graphics-ii"><span class="header-section-number">20</span> Grammer of layered graphics II</a></li>
<li>
<a class="nav-link" href="#scales"><span class="header-section-number">20.1</span> Scales</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#transformations"><span class="header-section-number">20.1.1</span> Transformations</a></li>
<li><a class="nav-link" href="#labeling"><span class="header-section-number">20.1.2</span> Labeling</a></li>
</ul>
</li>
<li><a class="nav-link" href="#coordinates"><span class="header-section-number">20.2</span> Coordinates</a></li>
<li><a class="nav-link" href="#facets"><span class="header-section-number">20.3</span> Facets</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Urban Informatics Toolkit</strong>" was written by Josiah Parry. It was last built on 2021-01-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
