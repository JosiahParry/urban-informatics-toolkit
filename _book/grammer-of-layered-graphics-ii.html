<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 12 Grammer of layered graphics II | Urban Informatics Toolkit</title>
  <meta name="description" content="A hands on introduction approach to analyzing the urban Commons." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 12 Grammer of layered graphics II | Urban Informatics Toolkit" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A hands on introduction approach to analyzing the urban Commons." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 12 Grammer of layered graphics II | Urban Informatics Toolkit" />
  
  <meta name="twitter:description" content="A hands on introduction approach to analyzing the urban Commons." />
  

<meta name="author" content="Josiah Parry" />


<meta name="date" content="2020-03-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualizing-trends-and-relationships.html"/>
<link rel="next" href="visualizing-beyond-2-dimensions.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Urban Informatics Toolkit</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="the-basics.html"><a href="the-basics.html"><i class="fa fa-check"></i><b>2</b> The basics</a></li>
<li class="chapter" data-level="3" data-path="r-as-a-calculator.html"><a href="r-as-a-calculator.html"><i class="fa fa-check"></i><b>3</b> R as a calculator</a></li>
<li class="part"><span><b>I Toolkit Foundations</b></span></li>
<li class="chapter" data-level="4" data-path="exploratory-visual-analysis.html"><a href="exploratory-visual-analysis.html"><i class="fa fa-check"></i><b>4</b> Exploratory Visual Analysis</a></li>
<li class="chapter" data-level="5" data-path="reading-data.html"><a href="reading-data.html"><i class="fa fa-check"></i><b>5</b> Reading data</a></li>
<li class="chapter" data-level="6" data-path="general-data-manipulation.html"><a href="general-data-manipulation.html"><i class="fa fa-check"></i><b>6</b> General data manipulation</a></li>
<li class="chapter" data-level="7" data-path="thats-too-much-data.html"><a href="thats-too-much-data.html"><i class="fa fa-check"></i><b>7</b> That’s <em>too much</em> data</a></li>
<li class="chapter" data-level="8" data-path="the-pipe.html"><a href="the-pipe.html"><i class="fa fa-check"></i><b>8</b> The pipe <code>%&gt;%</code></a></li>
<li class="part"><span><b>II II Vizualization Strategies</b></span></li>
<li class="chapter" data-level="9" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>9</b> Data Structures</a></li>
<li class="chapter" data-level="10" data-path="layered-i.html"><a href="layered-i.html"><i class="fa fa-check"></i><b>10</b> Grammer of layered graphics I</a></li>
<li class="chapter" data-level="11" data-path="visualizing-trends-and-relationships.html"><a href="visualizing-trends-and-relationships.html"><i class="fa fa-check"></i><b>11</b> Visualizing Trends and Relationships</a></li>
<li class="chapter" data-level="12" data-path="grammer-of-layered-graphics-ii.html"><a href="grammer-of-layered-graphics-ii.html"><i class="fa fa-check"></i><b>12</b> Grammer of layered graphics II</a></li>
<li class="chapter" data-level="13" data-path="visualizing-beyond-2-dimensions.html"><a href="visualizing-beyond-2-dimensions.html"><i class="fa fa-check"></i><b>13</b> Visualizing beyond 2-dimensions</a></li>
<li class="chapter" data-level="14" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>14</b> Summary statistics</a></li>
<li class="chapter" data-level="15" data-path="summarizing-the-tidy-way.html"><a href="summarizing-the-tidy-way.html"><i class="fa fa-check"></i><b>15</b> summarizing the tidy way</a></li>
<li class="chapter" data-level="16" data-path="i-have-two-datasets-what-now.html"><a href="i-have-two-datasets-what-now.html"><i class="fa fa-check"></i><b>16</b> I have two datasets, what now?</a></li>
<li class="chapter" data-level="17" data-path="spatial-analysis.html"><a href="spatial-analysis.html"><i class="fa fa-check"></i><b>17</b> Spatial Analysis</a></li>
<li class="chapter" data-level="18" data-path="creating-ecometrics.html"><a href="creating-ecometrics.html"><i class="fa fa-check"></i><b>18</b> Creating Ecometrics</a></li>
<li class="part"><span><b>III Case Studies</b></span></li>
<li class="chapter" data-level="19" data-path="case-study-twitter-data.html"><a href="case-study-twitter-data.html"><i class="fa fa-check"></i><b>19</b> Case Study: Twitter Data</a></li>
<li class="chapter" data-level="20" data-path="various-things-that-i-didnt-cover-well.html"><a href="various-things-that-i-didnt-cover-well.html"><i class="fa fa-check"></i><b>20</b> Various things that i didn’t cover well</a></li>
<li class="chapter" data-level="21" data-path="schools-of-urban-informatics.html"><a href="schools-of-urban-informatics.html"><i class="fa fa-check"></i><b>21</b> Schools of Urban Informatics</a></li>
<li class="chapter" data-level="22" data-path="broken-windows-and-the-origin-of-ecometrics.html"><a href="broken-windows-and-the-origin-of-ecometrics.html"><i class="fa fa-check"></i><b>22</b> Broken Windows and the origin of Ecometrics</a></li>
<li class="divider"></li>
<li><a href="https://github.com/josiahparry/urban-informatics-toolkit" target="blank">GitHub</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Urban Informatics Toolkit</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="grammer-of-layered-graphics-ii" class="section level1">
<h1><span class="header-section-number">Chapter 12</span> Grammer of layered graphics II</h1>
<p>We’ve developed a strong foundation for building charts from the ground up by specifying our <strong>defaults</strong> (data, and aesthetic mappings), and adding geom <strong>layers</strong>. In order to take our charts to the next level we need to familiarize ourselves with the other components of the <em>Layered Grammar of Graphics</em>: scales, coordinates, and facets.</p>
<div id="scales" class="section level2">
<h2><span class="header-section-number">12.1</span> Scales</h2>
<p>Recall from <em><a href="layered-i.html#layered-i">Grammar of Layered Graphics I</a></em> that when we supply our aesthetic mappings our axes are filled out automatically.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" data-line-number="1">(p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(acs, <span class="kw">aes</span>(med_house_income, bach)))</a></code></pre></div>
<p><img src="04c-grammar-II_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>By specifying our defaults in the <code>ggplot()</code> call, we implicitly are providing the x and y axes. From those mappings, ggplot2 is able to identify the type of variable mapped to each aesthetic and its values. That inference makes it possible for us to plot without having to explicitly state what our axes are.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(acs, <span class="kw">aes</span>(med_house_income, bach)) <span class="op">+</span></a>
<a class="sourceLine" id="cb185-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</a></code></pre></div>
<p>In the above chart, each column is being mapped as a continuous variable. We are able to manually specify what each scale type is by using the various <code>scale_*_type()</code> layers from ggplot2. These layers follow a general format of first specifying <code>scale</code> followed by which aesthetic we’re scaling, and what data type. For example, to change the <code>med_house_income</code> axis to a discrete axis we can apply the layer <code>scale_x_discrete()</code></p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1">p <span class="op">+</span></a>
<a class="sourceLine" id="cb186-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_x_discrete</span>() </a></code></pre></div>
<p><img src="04c-grammar-II_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>In doing so we have lost the axis labels! That is because ggplot2 considers both integers and floating point (numbers with decimals) as continuous and categorical variables as being discrete.</p>
<p>Nonetheless, we have a lot of functions at our disposal to alter the axes to our liking!</p>
<div id="transformations" class="section level3">
<h3><span class="header-section-number">12.1.1</span> Transformations</h3>
<p>In our data exploration, we will come across non-normal distributions of data.</p>
<ul>
<li>income is almost always right skewed displaying some sort of log-normal-ish behavior.</li>
<li>we may not want to actually change to underlying values of that variable, but want to apply transformations for the purposes of visualization</li>
<li>in that case, we can apply scale transformations</li>
<li>in our visualization of income and education, there is a slight right skew to <code>med_house_income</code>
<ul>
<li>it doesn’t justify a logarithmic transformation, but may benefit from a sqrt transformation</li>
<li>we can apply this with <code>scale_x_sqrt()</code></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1">p <span class="op">+</span></a>
<a class="sourceLine" id="cb187-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_x_sqrt</span>() </a></code></pre></div>
<p><img src="04c-grammar-II_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>We can apply a log10 transformation as well with <code>scale_*_log10()</code>.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1">p <span class="op">+</span></a>
<a class="sourceLine" id="cb188-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_x_log10</span>() </a></code></pre></div>
<p><img src="04c-grammar-II_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p><code>lims()</code>
<code>expand_limits()</code></p>
<p>This is an overcorrection. The slight upward arch in the original plotting is now inverted. Nonetheless, I hope the point is made. In addition to being able to control the <strong>defaults</strong>, the <strong>layers</strong>, and now the <strong>scales</strong> you are well equipped to develop and manipulate your own plots.</p>
<p>It is also important to note that what we have gone through is by no means exhaustive. You should, at minimum, familiarize yourself with both <code>scale_*_reverse()</code>, and <code>scale_*_binned()</code> in your spare time. There are dozens, if not hundreds, of ggplot2 functions to suit your every whim. And, as you have already briefly seen, the ggplot function universe is not relegated to just ggplot2. There are many other packages which have built custom geoms and other enhancements that may benefit you.</p>
</div>
<div id="labeling" class="section level3">
<h3><span class="header-section-number">12.1.2</span> Labeling</h3>
<p>The plots we create, while lovely as they are, are somewhat lacking in the labeling department. I would put money on it that no publication would accept plots with labels such as the ones above for sole reason being that our axes titles and scale labels are hard to interpret.</p>
<p>We’ve already used it befofe but to be extra clear, to add titles and axis labels to our plots (not adjusting the scale labels) we use a <code>labs()</code> layer. With <code>labs()</code>, you can label any aesthetic you have mapped as well as adding a <code>title</code>, <code>subtitle</code>, <code>caption</code>, and a <code>tag</code>.</p>
<p>Let’s add some titles and labels to our plot.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(acs, <span class="kw">aes</span>(med_house_income, bach)) <span class="op">+</span></a>
<a class="sourceLine" id="cb189-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb189-3" data-line-number="3"><span class="st">    </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb189-4" data-line-number="4">       <span class="dt">y =</span> <span class="st">&quot;% of population with a Bachelor&#39;s Degree&quot;</span>,</a>
<a class="sourceLine" id="cb189-5" data-line-number="5">       <span class="dt">x =</span> <span class="st">&quot;Median Household Income&quot;</span>,</a>
<a class="sourceLine" id="cb189-6" data-line-number="6">       <span class="dt">title =</span> <span class="st">&quot;Relationship between Education and Income&quot;</span>,</a>
<a class="sourceLine" id="cb189-7" data-line-number="7">       <span class="dt">subtitle =</span> <span class="st">&quot;All Massachusetts Tracts&quot;</span>,</a>
<a class="sourceLine" id="cb189-8" data-line-number="8">       <span class="dt">caption =</span> <span class="st">&quot;Source: Boston Area Research Initiative</span><span class="ch">\n</span><span class="st">via US Census Bureau&quot;</span></a>
<a class="sourceLine" id="cb189-9" data-line-number="9">      )</a>
<a class="sourceLine" id="cb189-10" data-line-number="10"></a>
<a class="sourceLine" id="cb189-11" data-line-number="11">p</a></code></pre></div>
<p><img src="04c-grammar-II_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Friends, it’s looking pretty good. But there are just two more changes we need to make: our axes labels! The x and y axes labels are meant to illustrate dollar amounts and percentages but respectively. To change the <em>scale</em> labels. we will use some helper functions from the package <a href="https://scales.r-lib.org/"><code>scales</code></a></p>
<p>{scales} provides handy functions for taking a variable and altering the labeling to match some other format. In our case, we are interested in printing our <code>med_house_income</code> as in a dollar format, i.e. <code>2000</code> becomes <code>\$2,000</code>, and <code>bach</code> as a percentage, i.e. <code>.4</code> becomes <code>%40</code>. To alter our labels we will use <code>scales::dollar()</code>, and <code>scales::percent()</code> respectively.</p>
<blockquote>
<p>Isn’t it nice how well named functions can be sometimes?</p>
</blockquote>
<p>To produce the examples outlines above we would call the function as such:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">scales<span class="op">::</span><span class="kw">dollar</span>(<span class="dv">2000</span>)</a>
<a class="sourceLine" id="cb190-2" data-line-number="2"><span class="co">## [1] &quot;$2,000&quot;</span></a>
<a class="sourceLine" id="cb190-3" data-line-number="3">scales<span class="op">::</span><span class="kw">percent</span>(.<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb190-4" data-line-number="4"><span class="co">## [1] &quot;40%&quot;</span></a></code></pre></div>
<p>Now we have an understanding of <em>how</em> the function behaves, but where do we actually change the labels? This is where we come full cirlce back to our <code>scale_*_continuous()</code> layer. As we mentioned earlier, <code>ggplot()</code> will handle making the scales for us. But <code>ggplot()</code> doesn’t know how we want to label our variables or how they should appear on the axes. And now the impetus is on us to make these changes manually. To change the axis labels we will specify which axis we are altering using the proper scale layer—i.e. <code>scale_y...</code> or <code>scale_x...</code>.</p>
</div>
</div>
<div id="coordinates" class="section level2">
<h2><span class="header-section-number">12.2</span> Coordinates</h2>
<p><code>coord_flip()</code>
<code>coord_cartesian()</code> - our default
<code>coord_polar()</code></p>
</div>
<div id="facets" class="section level2">
<h2><span class="header-section-number">12.3</span> Facets</h2>
<p><code>facet_wrap()</code>
<code>facet_grid()</code></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualizing-trends-and-relationships.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualizing-beyond-2-dimensions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["urban-commons-toolkit.pdf", "urban-commons-toolkit.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
