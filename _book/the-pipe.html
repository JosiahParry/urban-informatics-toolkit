<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12 The pipe %&gt;% | Urban Informatics Toolkit</title>
<meta name="author" content="Josiah Parry">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.5.3/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Urban Informatics Toolkit</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome</a></li>
<li class="book-part">Foundations of Urban Informatics</li>
<li><a class="" href="the-utility-and-danger-of-big-data.html"><span class="header-section-number">2</span> The Utility and Danger of Big Data</a></li>
<li><a class="" href="data-in-the-municipal-context.html"><span class="header-section-number">3</span> Data in the municipal context</a></li>
<li><a class="" href="approaches-to-and-schools-of-urban-informatics.html"><span class="header-section-number">4</span> Approaches to and Schools of Urban Informatics</a></li>
<li><a class="" href="ecometrics.html"><span class="header-section-number">5</span> Ecometrics</a></li>
<li class="book-part">Toolkit Foundations</li>
<li><a class="" href="the-basics.html"><span class="header-section-number">6</span> The basics</a></li>
<li><a class="" href="r-as-a-calculator.html"><span class="header-section-number">7</span> R as a calculator</a></li>
<li><a class="" href="reading-data.html"><span class="header-section-number">8</span> Reading data</a></li>
<li><a class="" href="exploratory-visual-analysis.html"><span class="header-section-number">9</span> Exploratory Visual Analysis</a></li>
<li><a class="" href="general-data-manipulation.html"><span class="header-section-number">10</span> General data manipulation</a></li>
<li><a class="" href="thats-too-much-data.html"><span class="header-section-number">11</span> That’s too much data</a></li>
<li><a class="active" href="the-pipe.html"><span class="header-section-number">12</span> The pipe %&gt;%</a></li>
<li><a class="" href="creating-new-measures.html"><span class="header-section-number">13</span> Creating new measures</a></li>
<li><a class="" href="data-structures.html"><span class="header-section-number">14</span> Data Structures</a></li>
<li><a class="" href="summary-statistics.html"><span class="header-section-number">15</span> Summary statistics</a></li>
<li><a class="" href="summarizing-the-tidy-way.html"><span class="header-section-number">16</span> Summarizing the tidy way</a></li>
<li><a class="" href="toolkit-review.html"><span class="header-section-number">17</span> Toolkit review</a></li>
<li class="book-part">Vizualization Strategies</li>
<li><a class="" href="layered-i.html"><span class="header-section-number">18</span> Grammar of layered graphics I</a></li>
<li><a class="" href="visualizing-trends-and-relationships.html"><span class="header-section-number">19</span> Visualizing Trends and Relationships</a></li>
<li><a class="" href="grammer-of-layered-graphics-ii.html"><span class="header-section-number">20</span> Grammer of layered graphics II</a></li>
<li><a class="" href="visualizing-beyond-2-dimensions.html"><span class="header-section-number">21</span> Visualizing beyond 2-dimensions</a></li>
<li><a class="" href="visualizing-through-time.html"><span class="header-section-number">22</span> Visualizing through time</a></li>
<li><a class="" href="visualization-review.html"><span class="header-section-number">23</span> Visualization Review</a></li>
<li class="book-part">Expanding the Toolkit</li>
<li><a class="" href="multiple-data-sets.html"><span class="header-section-number">24</span> Multiple data sets</a></li>
<li><a class="" href="statistics.html"><span class="header-section-number">25</span> Statistics</a></li>
<li><a class="" href="spatial-analysis.html"><span class="header-section-number">26</span> Spatial Analysis</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="the-pipe" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> The pipe <code>%&gt;%</code><a class="anchor" aria-label="anchor" href="#the-pipe"><i class="fas fa-link"></i></a>
</h1>
<p>Until now we have been using one function at a time. This can feel like it is rather limiting at times. The approach that we have been taking has been to perform some action, save the resultant object, and then perform another action. This leads to either overwriting the same existing object multiple times with an assignment <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code> or creating multiple other objects. The former solution does not have a great story for reproducibility. At any point within a script may refr to many different objects with the same name. The second solution can clutter your working environment and lead to an excess usage of memory.</p>
<p>Well then, “what do we do instead?” you may be asking. And my answer is “use the forward pipe operator, of course.” The forward pipe operator looks like <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code>. This is a special function which allows the user to “pipe an object forward into a function or . . . expression” (Milton and Wickham, 2019). This is where the true power of the tidyverse comes from from.</p>
<p><strong>What it does</strong>: The pipe operator takes the object or the output an expression on it’s left hand side <code>lhs</code> and provides that as the first argument in the function of the right hand side. Additionally, it exposes the <code>lhs</code> as a temporary variable <code>.</code>. It is documented as <code>lhs %&gt;% rhs</code>.</p>
<p>The creator of <a href="https://github.com/rfordatascience/tidytuesday">#TidyTuesday</a> and RStudio employee, Thomas Mock has created a very illustrative example of how the pipe can simplify complex R function calls<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Tidy Tuesday is a weekly online community event in which useRs across the world analyse the same dataset and share their visualizations online. Get involved on twitter with &lt;code&gt;#TidyTuesday&lt;/code&gt;.&lt;/p&gt;"><sup>55</sup></a>.</p>
<p>The first example illustrates the creation of intermediate variables.</p>
<pre><code>did_something &lt;- do_something(data)

did_another_thing &lt;- do_another_thing(did_something)

final_thing &lt;- do_last_thing(did_another_thing)</code></pre>
<p>The second demonstrates nesting function calls inside of other function calls.</p>
<pre><code>final_thing &lt;- do_last_thing(
  do_another_thing(
    do_something(
      data
    )
  )
)</code></pre>
<p>Nested function calls are often difficult to debug and the user may get caught up in the mintuae of properly places parentheses.</p>
<blockquote>
<p>Note: Debugging is the process of taking misbehaving code and fixing it.</p>
</blockquote>
<p>Using the pipe this chain of functions can be rewritten in the order that it happens.</p>
<pre><code>final_thing &lt;- data %&gt;% 
  do_something() %&gt;% 
  do_another_thing() %&gt;% 
  do_last_thing()</code></pre>
<p>By using the pipe we are able to align our thinking and code writing. Additionally, each function call is separated on its own line which makes debugging a less daunting task.</p>
<div id="applying-the-pipe" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> Applying the pipe<a class="anchor" aria-label="anchor" href="#applying-the-pipe"><i class="fas fa-link"></i></a>
</h2>
<p>Remember how I pointed out that the first argument for almost every function is the data? This is where that comes in handy. This allows us to use the pipe to chain together functions and “makes it more intuitive to both read and write” (magrittr vignette).</p>
<p>The tidyverse was designed with this in mind. This is why <code><a href="https://rdrr.io/pkg/dplyr/man/select.html">select()</a></code>, <code><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter()</a></code>, and <code><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate()</a></code> among many others are data first functions. Moreover, the output of each function is always a data frame which allows the user to provide that output as input into the next function.</p>
<p>As always, the most helpful way to wrap your head around this is to see it in action. Let’s take one of the lines of code we used above and adapt it to use a pipe. We will select the name column of our data again. Previously we may have written</p>
<pre><code>my_tbl &lt;- select(data_frame, ...)
smaller_tbl &lt;- filter(my_tbl, ...)
new_col_tbl &lt;- mutate(smaller_tbl, ...)</code></pre>
<p>But now we are able to write more complex function chains such as</p>
<pre><code>data %&gt;% 
  filter() %&gt;% 
  mutate() %&gt;% 
  select()</code></pre>
<p>In the chapter on filtering data we began by reading in the data, selecting columns, and then filtered data. Here we will recreate the <code>low_inc_or_walk</code> object which identified Census Tracts that have a higher rate of commuters who walk than drive or have a median household income below $40,000.</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">low_inc_or_walk</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/ACS_1317_TRACT.csv"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span>
    <span class="va">county</span>,
    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"commute"</span><span class="op">)</span>,
    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"by"</span><span class="op">)</span>,
    <span class="va">med_house_income</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span>
    <span class="va">by_walk</span> <span class="op">&gt;</span> <span class="va">by_auto</span>,
    <span class="va">med_house_income</span> <span class="op">&lt;</span> <span class="fl">40000</span>
  <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tibble/man/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">low_inc_or_walk</span><span class="op">)</span>
<span class="co">#&gt; Rows: 11</span>
<span class="co">#&gt; Columns: 11</span>
<span class="co">#&gt; $ county           &lt;chr&gt; "HAMPSHIRE", "SUFFOLK", "SUFFOLK", "SUFFOLK", "SUFFO…</span>
<span class="co">#&gt; $ commute_less10   &lt;dbl&gt; 0.40234261, 0.34490741, 0.41918528, 0.09421755, 0.06…</span>
<span class="co">#&gt; $ commute1030      &lt;dbl&gt; 0.5077599, 0.3726852, 0.4042926, 0.5200162, 0.552884…</span>
<span class="co">#&gt; $ commute3060      &lt;dbl&gt; 0.07027818, 0.22777778, 0.14673675, 0.35624747, 0.27…</span>
<span class="co">#&gt; $ commute6090      &lt;dbl&gt; 0.01288433, 0.04953704, 0.02058695, 0.02951880, 0.07…</span>
<span class="co">#&gt; $ commute_over90   &lt;dbl&gt; 0.006734993, 0.005092593, 0.009198423, 0.000000000, …</span>
<span class="co">#&gt; $ by_auto          &lt;dbl&gt; 0.1889132, 0.2140026, 0.1082621, 0.1704500, 0.159292…</span>
<span class="co">#&gt; $ by_pub_trans     &lt;dbl&gt; 0.04570873, 0.11933069, 0.15384615, 0.29191557, 0.30…</span>
<span class="co">#&gt; $ by_bike          &lt;dbl&gt; 0.014344761, 0.019815059, 0.008547009, 0.071286340, …</span>
<span class="co">#&gt; $ by_walk          &lt;dbl&gt; 0.5801118, 0.5808014, 0.6471306, 0.4066109, 0.380531…</span>
<span class="co">#&gt; $ med_house_income &lt;dbl&gt; 2499, 21773, 36250, 34677, 30500, 28618, 16094, 1926…</span></code></pre></div>
<p>The reason this pipe works is because the output of each function call is yet another tibble and the pipe operator is passing that resultant tibble as the first argument to the next function.</p>
<p>Not only does the pipe aid in the manipulation of data, it also has a lot of utility in crafting ggplots. By piping your tibble into a ggplot call, this allows you to quickly iterate on the input data from either filtering down your data to creating new variables for visualization purposes.</p>
<p>The following sections will use the pipe operator in favor of the above listed alternatives.</p>
</div>
<div id="revisiting-our-scenario" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> Revisiting our scenario<a class="anchor" aria-label="anchor" href="#revisiting-our-scenario"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have the pipe operator at our fingertips, we ought to think about how we can incorporate it into our previous work. In our earlier scenario we</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">acs_raw</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/ACS_1317_TRACT.csv"</span><span class="op">)</span>

<span class="va">commute</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">acs_raw</span>,
       <span class="va">county</span>,
       <span class="va">hs_grad</span>, <span class="va">bach</span>, <span class="va">master</span>,
       <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"commute"</span><span class="op">)</span>,
       <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"by"</span><span class="op">)</span>,
       <span class="va">med_house_income</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">county</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SUFFOLK"</span>, <span class="st">"NORFOLK"</span>, <span class="st">"MIDDLESEX"</span><span class="op">)</span><span class="op">)</span></code></pre></div>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="thats-too-much-data.html"><span class="header-section-number">11</span> That’s too much data</a></div>
<div class="next"><a href="creating-new-measures.html"><span class="header-section-number">13</span> Creating new measures</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-pipe"><span class="header-section-number">12</span> The pipe %&gt;%</a></li>
<li><a class="nav-link" href="#applying-the-pipe"><span class="header-section-number">12.1</span> Applying the pipe</a></li>
<li><a class="nav-link" href="#revisiting-our-scenario"><span class="header-section-number">12.2</span> Revisiting our scenario</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Urban Informatics Toolkit</strong>" was written by Josiah Parry. It was last built on 2021-01-05.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
