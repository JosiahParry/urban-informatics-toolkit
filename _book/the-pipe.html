<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 The pipe %&gt;% | Urban Informatics Toolkit</title>
  <meta name="description" content="A hands on introduction approach to analyzing the urban Commons." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 The pipe %&gt;% | Urban Informatics Toolkit" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A hands on introduction approach to analyzing the urban Commons." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 The pipe %&gt;% | Urban Informatics Toolkit" />
  
  <meta name="twitter:description" content="A hands on introduction approach to analyzing the urban Commons." />
  

<meta name="author" content="Josiah Parry" />


<meta name="date" content="2020-03-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="thats-too-much-data.html"/>
<link rel="next" href="data-structures.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Urban Informatics Toolkit</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="the-basics.html"><a href="the-basics.html"><i class="fa fa-check"></i><b>2</b> The basics</a></li>
<li class="chapter" data-level="3" data-path="r-as-a-calculator.html"><a href="r-as-a-calculator.html"><i class="fa fa-check"></i><b>3</b> R as a calculator</a></li>
<li class="part"><span><b>I Toolkit Foundations</b></span></li>
<li class="chapter" data-level="4" data-path="exploratory-visual-analysis.html"><a href="exploratory-visual-analysis.html"><i class="fa fa-check"></i><b>4</b> Exploratory Visual Analysis</a></li>
<li class="chapter" data-level="5" data-path="reading-data.html"><a href="reading-data.html"><i class="fa fa-check"></i><b>5</b> Reading data</a></li>
<li class="chapter" data-level="6" data-path="general-data-manipulation.html"><a href="general-data-manipulation.html"><i class="fa fa-check"></i><b>6</b> General data manipulation</a></li>
<li class="chapter" data-level="7" data-path="thats-too-much-data.html"><a href="thats-too-much-data.html"><i class="fa fa-check"></i><b>7</b> That’s <em>too much</em> data</a></li>
<li class="chapter" data-level="8" data-path="the-pipe.html"><a href="the-pipe.html"><i class="fa fa-check"></i><b>8</b> The pipe <code>%&gt;%</code></a></li>
<li class="chapter" data-level="9" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>9</b> Data Structures</a></li>
<li class="chapter" data-level="10" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>10</b> Summary statistics</a></li>
<li class="chapter" data-level="11" data-path="summarizing-the-tidy-way.html"><a href="summarizing-the-tidy-way.html"><i class="fa fa-check"></i><b>11</b> summarizing the tidy way</a></li>
<li class="part"><span><b>II Vizualization Strategies</b></span></li>
<li class="chapter" data-level="12" data-path="layered-i.html"><a href="layered-i.html"><i class="fa fa-check"></i><b>12</b> Grammer of layered graphics I</a></li>
<li class="chapter" data-level="13" data-path="visualizing-trends-and-relationships.html"><a href="visualizing-trends-and-relationships.html"><i class="fa fa-check"></i><b>13</b> Visualizing Trends and Relationships</a></li>
<li class="chapter" data-level="14" data-path="grammer-of-layered-graphics-ii.html"><a href="grammer-of-layered-graphics-ii.html"><i class="fa fa-check"></i><b>14</b> Grammer of layered graphics II</a></li>
<li class="chapter" data-level="15" data-path="visualizing-beyond-2-dimensions.html"><a href="visualizing-beyond-2-dimensions.html"><i class="fa fa-check"></i><b>15</b> Visualizing beyond 2-dimensions</a></li>
<li class="part"><span><b>III More than hammer and nails</b></span></li>
<li class="chapter" data-level="16" data-path="i-have-two-datasets-what-now.html"><a href="i-have-two-datasets-what-now.html"><i class="fa fa-check"></i><b>16</b> I have two datasets, what now?</a></li>
<li class="chapter" data-level="17" data-path="spatial-analysis.html"><a href="spatial-analysis.html"><i class="fa fa-check"></i><b>17</b> Spatial Analysis</a></li>
<li class="chapter" data-level="18" data-path="creating-ecometrics.html"><a href="creating-ecometrics.html"><i class="fa fa-check"></i><b>18</b> Creating Ecometrics</a></li>
<li class="part"><span><b>IV Case Studies</b></span></li>
<li class="chapter" data-level="19" data-path="case-study-twitter-data.html"><a href="case-study-twitter-data.html"><i class="fa fa-check"></i><b>19</b> Case Study: Twitter Data</a></li>
<li class="chapter" data-level="20" data-path="various-things-that-i-didnt-cover-well.html"><a href="various-things-that-i-didnt-cover-well.html"><i class="fa fa-check"></i><b>20</b> Various things that i didn’t cover well</a></li>
<li class="chapter" data-level="21" data-path="schools-of-urban-informatics.html"><a href="schools-of-urban-informatics.html"><i class="fa fa-check"></i><b>21</b> Schools of Urban Informatics</a></li>
<li class="chapter" data-level="22" data-path="broken-windows-and-the-origin-of-ecometrics.html"><a href="broken-windows-and-the-origin-of-ecometrics.html"><i class="fa fa-check"></i><b>22</b> Broken Windows and the origin of Ecometrics</a></li>
<li class="divider"></li>
<li><a href="https://github.com/josiahparry/urban-informatics-toolkit" target="blank">GitHub</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Urban Informatics Toolkit</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-pipe" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> The pipe <code>%&gt;%</code></h1>
<p>Until now we have been using one function at a time. This can feel like it is rather limiting at times. The approach that we have been taking has been to perform some action, save the resultant object, and then perform another action. This leads to either overwriting the same existing object multiple times with an assignment <code>&lt;-</code> or creating multiple other objects. The former solution does not have a great story for reproducibility. At any point within a script may refr to many different objects with the same name. The second solution can clutter your working environment and lead to an excess usage of memory.</p>
<p>Well then, “what do we do instead?” you may be asking. And my answer is “use the forward pipe operator, of course.” The forward pipe operator looks like <code>%&gt;%</code>. This is a special function which allows the user to “pipe an object forward into a function or . . . expression” (Milton and Wickham, 2019). This is where the true power of the tidyverse comes from from.</p>
<p><strong>What it does</strong>: The pipe operator takes the object or the output an expression on it’s left hand side <code>lhs</code> and provides that as the first argument in the function of the right hand side. Additionally, it exposes the <code>lhs</code> as a temporary variable <code>.</code>. It is documented as <code>lhs %&gt;% rhs</code>.</p>
<p>The creator of <a href="https://github.com/rfordatascience/tidytuesday">#TidyTuesday</a> and RStudio employee Thomas Mock has created a very illustrative example of how the pipe can simplify complex R function calls.</p>
<p>The first example illustrates the creation of intermediate variables.</p>
<pre><code>did_something &lt;- do_something(data)

did_another_thing &lt;- do_another_thing(did_something)

final_thing &lt;- do_last_thing(did_another_thing)</code></pre>
<p>The second demonstrates nesting function calls inside of other function calls.</p>
<pre><code>final_thing &lt;- do_last_thing(
  do_another_thing(
    do_something(
      data
    )
  )
)</code></pre>
<p>Nested function calls are often difficult to debug and the user may get caught up in the mintuae of properly places parentheses.</p>
<blockquote>
<p>Note: Debugging is the process of taking misbehaving code and fixing it.</p>
</blockquote>
<p>Using the pipe this chain of functions can be rewritten in the order that it happens.</p>
<pre><code>final_thing &lt;- data %&gt;% 
  do_something() %&gt;% 
  do_another_thing() %&gt;% 
  do_last_thing()</code></pre>
<p>By using the pipe we are able to align our thinking and code writing. Additionally, each function call is separated on its own line which makes debugging a less daunting task.</p>
<div id="applying-the-pipe." class="section level2">
<h2><span class="header-section-number">8.1</span> Applying the pipe.</h2>
<p>Remember how I pointed out that the first argument for almost every function is the data? This is where that comes in handy. This allows us to use the pipe to chain together functions and “makes it more intuitive to both read and write” (magrittr vignette).</p>
<p>The tidyverse was designed with this in mind. This is why <code>select()</code>, <code>filter()</code>, and <code>mutate()</code> among many others are data first functions. Moreover, the output of each function is always a data frame which allows the user to provide that output as input into the next function.</p>
<p>As always, the most helpful way to wrap your head around this is to see it in action. Let’s take one of the lines of code we used above and adapt it to use a pipe. We will select the name column of our data again. Previously we may have written</p>
<pre><code>my_tbl &lt;- select(data_frame, ...)
smaller_tbl &lt;- filter(my_tbl, ...)
new_col_tbl &lt;- mutate(smaller_tbl, ...)</code></pre>
<p>But now we are able to write more complex function chains such as</p>
<pre><code>data %&gt;% 
  filter() %&gt;% 
  mutate() %&gt;% 
  select()</code></pre>
<p>In the chapter on filtering data we began by reading in the data, selecting columns, and then filtered data. Here we will recreate the <code>low_inc_or_walk</code> object which identified Census Tracts that have a higher rate of commuters who walk than drive or have a median household income below $40,000.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb109-2" data-line-number="2"></a>
<a class="sourceLine" id="cb109-3" data-line-number="3">low_inc_or_walk &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/ACS_1317_TRACT.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb109-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb109-5" data-line-number="5">    county,</a>
<a class="sourceLine" id="cb109-6" data-line-number="6">    <span class="kw">starts_with</span>(<span class="st">&quot;commute&quot;</span>),</a>
<a class="sourceLine" id="cb109-7" data-line-number="7">    <span class="kw">starts_with</span>(<span class="st">&quot;by&quot;</span>),</a>
<a class="sourceLine" id="cb109-8" data-line-number="8">    med_house_income</a>
<a class="sourceLine" id="cb109-9" data-line-number="9">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb109-10" data-line-number="10"><span class="st">  </span><span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb109-11" data-line-number="11">    by_walk <span class="op">&gt;</span><span class="st"> </span>by_auto,</a>
<a class="sourceLine" id="cb109-12" data-line-number="12">    med_house_income <span class="op">&lt;</span><span class="st"> </span><span class="dv">40000</span></a>
<a class="sourceLine" id="cb109-13" data-line-number="13">  )</a>
<a class="sourceLine" id="cb109-14" data-line-number="14"></a>
<a class="sourceLine" id="cb109-15" data-line-number="15"><span class="kw">glimpse</span>(low_inc_or_walk)</a>
<a class="sourceLine" id="cb109-16" data-line-number="16"><span class="co">## Observations: 11</span></a>
<a class="sourceLine" id="cb109-17" data-line-number="17"><span class="co">## Variables: 11</span></a>
<a class="sourceLine" id="cb109-18" data-line-number="18"><span class="co">## $ county           &lt;chr&gt; &quot;HAMPSHIRE&quot;, &quot;SUFFOLK&quot;, &quot;SUFFOLK&quot;, &quot;SUFFOLK&quot;, &quot;…</span></a>
<a class="sourceLine" id="cb109-19" data-line-number="19"><span class="co">## $ commute_less10   &lt;dbl&gt; 0.40234261, 0.34490741, 0.41918528, 0.09421755,…</span></a>
<a class="sourceLine" id="cb109-20" data-line-number="20"><span class="co">## $ commute1030      &lt;dbl&gt; 0.5077599, 0.3726852, 0.4042926, 0.5200162, 0.5…</span></a>
<a class="sourceLine" id="cb109-21" data-line-number="21"><span class="co">## $ commute3060      &lt;dbl&gt; 0.07027818, 0.22777778, 0.14673675, 0.35624747,…</span></a>
<a class="sourceLine" id="cb109-22" data-line-number="22"><span class="co">## $ commute6090      &lt;dbl&gt; 0.01288433, 0.04953704, 0.02058695, 0.02951880,…</span></a>
<a class="sourceLine" id="cb109-23" data-line-number="23"><span class="co">## $ commute_over90   &lt;dbl&gt; 0.006734993, 0.005092593, 0.009198423, 0.000000…</span></a>
<a class="sourceLine" id="cb109-24" data-line-number="24"><span class="co">## $ by_auto          &lt;dbl&gt; 0.1889132, 0.2140026, 0.1082621, 0.1704500, 0.1…</span></a>
<a class="sourceLine" id="cb109-25" data-line-number="25"><span class="co">## $ by_pub_trans     &lt;dbl&gt; 0.04570873, 0.11933069, 0.15384615, 0.29191557,…</span></a>
<a class="sourceLine" id="cb109-26" data-line-number="26"><span class="co">## $ by_bike          &lt;dbl&gt; 0.014344761, 0.019815059, 0.008547009, 0.071286…</span></a>
<a class="sourceLine" id="cb109-27" data-line-number="27"><span class="co">## $ by_walk          &lt;dbl&gt; 0.5801118, 0.5808014, 0.6471306, 0.4066109, 0.3…</span></a>
<a class="sourceLine" id="cb109-28" data-line-number="28"><span class="co">## $ med_house_income &lt;dbl&gt; 2499, 21773, 36250, 34677, 30500, 28618, 16094,…</span></a></code></pre></div>
<p>The reason this pipe works is because the output of each function call is yet another tibble and the pipe operator is passing that resultant tibble as the first argument to the next function.</p>
<p>Not only does the pipe aid in the manipulation of data, it also has a lot of utility in crafting ggplots. By piping your tibble into a ggplot call, this allows you to quickly iterate on the input data from either filtering down your data to creating new variables for visualization purposes.</p>
<p>The following sections will use the pipe operator in favor of the above listed alternatives.</p>
</div>
<div id="revisiting-our-scenario" class="section level2">
<h2><span class="header-section-number">8.2</span> Revisiting our scenario</h2>
<p>Now that we have the pipe operator at our fingertips, we ought to think about how we can incorporate it into our previous work. In our earlier scenario we</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1">acs_raw &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/ACS_1317_TRACT.csv&quot;</span>)</a>
<a class="sourceLine" id="cb110-2" data-line-number="2"></a>
<a class="sourceLine" id="cb110-3" data-line-number="3">commute &lt;-<span class="st"> </span><span class="kw">select</span>(acs_raw,</a>
<a class="sourceLine" id="cb110-4" data-line-number="4">       county,</a>
<a class="sourceLine" id="cb110-5" data-line-number="5">       hs_grad, bach, master,</a>
<a class="sourceLine" id="cb110-6" data-line-number="6">       <span class="kw">starts_with</span>(<span class="st">&quot;commute&quot;</span>),</a>
<a class="sourceLine" id="cb110-7" data-line-number="7">       <span class="kw">starts_with</span>(<span class="st">&quot;by&quot;</span>),</a>
<a class="sourceLine" id="cb110-8" data-line-number="8">       med_house_income) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb110-9" data-line-number="9"><span class="st">  </span><span class="kw">filter</span>(county <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;SUFFOLK&quot;</span>, <span class="st">&quot;NORFOLK&quot;</span>, <span class="st">&quot;MIDDLESEX&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb110-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hh_inc_quin =</span> <span class="kw">ntile</span>(med_house_income, <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb110-11" data-line-number="11">         <span class="dt">edu_attain =</span> bach <span class="op">+</span><span class="st"> </span>master) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb110-12" data-line-number="12"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>bach, <span class="op">-</span>master)</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="thats-too-much-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-structures.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["urban-commons-toolkit.pdf", "urban-commons-toolkit.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
