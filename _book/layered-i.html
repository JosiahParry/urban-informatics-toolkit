<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 18 Grammar of layered graphics I | Urban Informatics Toolkit</title>
<meta name="author" content="Josiah Parry">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.5.3/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Urban Informatics Toolkit</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome</a></li>
<li class="book-part">Foundations of Urban Informatics</li>
<li><a class="" href="the-utility-and-danger-of-big-data.html"><span class="header-section-number">2</span> The Utility and Danger of Big Data</a></li>
<li><a class="" href="data-in-the-municipal-context.html"><span class="header-section-number">3</span> Data in the municipal context</a></li>
<li><a class="" href="approaches-to-and-schools-of-urban-informatics.html"><span class="header-section-number">4</span> Approaches to and Schools of Urban Informatics</a></li>
<li><a class="" href="ecometrics.html"><span class="header-section-number">5</span> Ecometrics</a></li>
<li class="book-part">Toolkit Foundations</li>
<li><a class="" href="the-basics.html"><span class="header-section-number">6</span> The basics</a></li>
<li><a class="" href="r-as-a-calculator.html"><span class="header-section-number">7</span> R as a calculator</a></li>
<li><a class="" href="reading-data.html"><span class="header-section-number">8</span> Reading data</a></li>
<li><a class="" href="exploratory-visual-analysis.html"><span class="header-section-number">9</span> Exploratory Visual Analysis</a></li>
<li><a class="" href="general-data-manipulation.html"><span class="header-section-number">10</span> General data manipulation</a></li>
<li><a class="" href="thats-too-much-data.html"><span class="header-section-number">11</span> That’s too much data</a></li>
<li><a class="" href="the-pipe.html"><span class="header-section-number">12</span> The pipe %&gt;%</a></li>
<li><a class="" href="creating-new-measures.html"><span class="header-section-number">13</span> Creating new measures</a></li>
<li><a class="" href="data-structures.html"><span class="header-section-number">14</span> Data Structures</a></li>
<li><a class="" href="summary-statistics.html"><span class="header-section-number">15</span> Summary statistics</a></li>
<li><a class="" href="summarizing-the-tidy-way.html"><span class="header-section-number">16</span> Summarizing the tidy way</a></li>
<li><a class="" href="toolkit-review.html"><span class="header-section-number">17</span> Toolkit review</a></li>
<li class="book-part">Vizualization Strategies</li>
<li><a class="active" href="layered-i.html"><span class="header-section-number">18</span> Grammar of layered graphics I</a></li>
<li><a class="" href="visualizing-trends-and-relationships.html"><span class="header-section-number">19</span> Visualizing Trends and Relationships</a></li>
<li><a class="" href="grammer-of-layered-graphics-ii.html"><span class="header-section-number">20</span> Grammer of layered graphics II</a></li>
<li><a class="" href="visualizing-beyond-2-dimensions.html"><span class="header-section-number">21</span> Visualizing beyond 2-dimensions</a></li>
<li><a class="" href="visualizing-through-time.html"><span class="header-section-number">22</span> Visualizing through time</a></li>
<li><a class="" href="visualization-review.html"><span class="header-section-number">23</span> Visualization Review</a></li>
<li class="book-part">Expanding the Toolkit</li>
<li><a class="" href="multiple-data-sets.html"><span class="header-section-number">24</span> Multiple data sets</a></li>
<li><a class="" href="statistics.html"><span class="header-section-number">25</span> Statistics</a></li>
<li><a class="" href="spatial-analysis.html"><span class="header-section-number">26</span> Spatial Analysis</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="layered-i" class="section level1" number="18">
<h1>
<span class="header-section-number">18</span> Grammar of layered graphics I<a class="anchor" aria-label="anchor" href="#layered-i"><i class="fas fa-link"></i></a>
</h1>
<p>You’ve made it quite far through this book. Now, I want to bring us back to the very beginning. In the first chapter we created a few visualizations with <code>ggplot2</code>. I want to unpack ggplot2 a bit more and also address some of the more philosophical underpinnings of visualization.</p>
<p>This chapter introduces you to the idea of the grammar of graphics, discusses when which visualizations are appropriate, and some fundamental design principles follow.</p>
<div id="the-grammar-of-layered-graphics" class="section level2" number="18.1">
<h2>
<span class="header-section-number">18.1</span> The Grammar of Layered Graphics<a class="anchor" aria-label="anchor" href="#the-grammar-of-layered-graphics"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>gg</code> in <code>ggplot2</code> refers to the grammar of graphics (and the <code>2</code> is because it’s the second iteration). <em>The Grammar of Graphics</em> (Wilkinson, 1999) is a seminal book in data visualization for the sciences in which, Wilkinson defines a complete system (grammar) for creating visualizations that go beyond the standard domain of “named graphics”—e.g. histogram, barchart, etc.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;A Layered Grammar of Graphics. Hadley Wickham. &lt;a href="https://vita.had.co.nz/papers/layered-grammar.pdf" class="uri"&gt;https://vita.had.co.nz/papers/layered-grammar.pdf&lt;/a&gt;&lt;/p&gt;'><sup>59</sup></a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;The Grammar of Graphics. &lt;a href="https://www.springer.com/gp/book/9780387245447" class="uri"&gt;https://www.springer.com/gp/book/9780387245447&lt;/a&gt;.&lt;/p&gt;'><sup>60</sup></a></p>
<p>ggplot2 is “an open source implementation of the grammar of graphics for <strong>R</strong>.”<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;A Layered Grammar of Graphics. Hadley Wickham. &lt;a href="https://vita.had.co.nz/papers/layered-grammar.pdf" class="uri"&gt;https://vita.had.co.nz/papers/layered-grammar.pdf&lt;/a&gt;&lt;/p&gt;'><sup>61</sup></a> Once we can internalize the grammar of graphics, creating plots will be an intuitive and artistic process rather than a mechanical one.</p>
<p>There are five high level components of the layered grammar<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;A Layered Grammar of Graphics. Hadley Wickham. &lt;a href="https://vita.had.co.nz/papers/layered-grammar.pdf" class="uri"&gt;https://vita.had.co.nz/papers/layered-grammar.pdf&lt;/a&gt;&lt;/p&gt;'><sup>62</sup></a>. We will only cover the first two in this chapter.</p>
<ol style="list-style-type: decimal">
<li>
<strong>Defaults</strong>:
<ul>
<li>Data</li>
<li>Mapping</li>
</ul>
</li>
<li>
<strong>Layers</strong>:
<ul>
<li>Data*</li>
<li>Mapping*</li>
<li>Geom</li>
<li>Stat</li>
<li>Position</li>
</ul>
</li>
<li>Scales</li>
<li>Coordinates</li>
<li>Facets</li>
</ol>
</div>
<div id="layers-and-defaults" class="section level2" number="18.2">
<h2>
<span class="header-section-number">18.2</span> Layers and defaults<a class="anchor" aria-label="anchor" href="#layers-and-defaults"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s first get some data into our environment. We will use the <code>commute</code> dataset again.</p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">commute</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/gba_commute.csv"</span><span class="op">)</span></code></pre></div>
<p>In the first chapter of this section we explored these principles but did not put a name to them. Recall that we can use <code><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot()</a></code> by itself and it returns a chart of nothing.</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04a-grammar-I_files/figure-html/unnamed-chunk-4-1.png" width="100%"></div>
<p>This is because we have not specified any of the defaults. In order for us to plot anything at all, we need to specify what (the data object) will be visualized, which features (the aesthetic mappings), and how (the geoms). When we begin to specify our x and y aesthetics the scales are interpreted.</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">commute</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">med_house_income</span>, <span class="va">by_auto</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04a-grammar-I_files/figure-html/unnamed-chunk-5-1.png" width="100%"></div>
<p>The final step is to add the geom layer which will inherit the data, aesthetic mappings, scale, and position while the <code>geom_*()</code> layer dictates the geometry.</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">commute</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">bach</span>, <span class="va">med_house_income</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04a-grammar-I_files/figure-html/unnamed-chunk-6-1.png" width="100%"></div>
<p>While this is the most common way you might define a ggplot, you should also be aware of the fact that each layer can stand on its own without you defining any of the defaults in the <code><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot()</a></code> call. Each geom inherits the defaults from <code><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot()</a></code>, but each <code>geom_*()</code> also has arguments for <code>data</code>, and <code>mapping</code>, providing you with increased flexibility.</p>
<blockquote>
<p>Note: the <code>geom_*()</code>s have the data as the second argument so either put the data there or name the argument explicitly. The choice is yours. Choose wisely!</p>
</blockquote>
<p>What happens if we provide all of this information to <code><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point()</a></code> and entirely omit <code><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot()</a></code>?</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">med_house_income</span>, <span class="va">by_auto</span><span class="op">)</span>, <span class="va">commute</span><span class="op">)</span>
<span class="co">#&gt; mapping: x = ~med_house_income, y = ~by_auto </span>
<span class="co">#&gt; geom_point: na.rm = FALSE</span>
<span class="co">#&gt; stat_identity: na.rm = FALSE</span>
<span class="co">#&gt; position_identity</span></code></pre></div>
<p>We see that we do not have the plot, but we do have all of the information required of a layer is printed out to the console. If we add an empty ggplot call ahead of the layer, we will be able to create the plot.</p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">med_house_income</span>, <span class="va">by_auto</span><span class="op">)</span>, <span class="va">commute</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04a-grammar-I_files/figure-html/unnamed-chunk-8-1.png" width="100%"></div>
<p>Being able to specify different data objects within each layer will provie to be extraordinarily helpful when we begin to work with spatial data, or plotting two different data frames with the same axes, or any other creative problem you wish to solve.</p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="toolkit-review.html"><span class="header-section-number">17</span> Toolkit review</a></div>
<div class="next"><a href="visualizing-trends-and-relationships.html"><span class="header-section-number">19</span> Visualizing Trends and Relationships</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#layered-i"><span class="header-section-number">18</span> Grammar of layered graphics I</a></li>
<li><a class="nav-link" href="#the-grammar-of-layered-graphics"><span class="header-section-number">18.1</span> The Grammar of Layered Graphics</a></li>
<li><a class="nav-link" href="#layers-and-defaults"><span class="header-section-number">18.2</span> Layers and defaults</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Urban Informatics Toolkit</strong>" was written by Josiah Parry. It was last built on 2021-01-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
