<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 16 Multiple data sets | Urban Informatics Toolkit</title>
  <meta name="description" content="A hands on introduction approach to analyzing the urban Commons." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 16 Multiple data sets | Urban Informatics Toolkit" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A hands on introduction approach to analyzing the urban Commons." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 16 Multiple data sets | Urban Informatics Toolkit" />
  
  <meta name="twitter:description" content="A hands on introduction approach to analyzing the urban Commons." />
  

<meta name="author" content="Josiah Parry" />


<meta name="date" content="2020-03-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualizing-beyond-2-dimensions.html"/>
<link rel="next" href="spatial-analysis.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Urban Informatics Toolkit</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="the-basics.html"><a href="the-basics.html"><i class="fa fa-check"></i><b>2</b> The basics</a></li>
<li class="chapter" data-level="3" data-path="r-as-a-calculator.html"><a href="r-as-a-calculator.html"><i class="fa fa-check"></i><b>3</b> R as a calculator</a></li>
<li class="part"><span><b>I Toolkit Foundations</b></span></li>
<li class="chapter" data-level="4" data-path="exploratory-visual-analysis.html"><a href="exploratory-visual-analysis.html"><i class="fa fa-check"></i><b>4</b> Exploratory Visual Analysis</a></li>
<li class="chapter" data-level="5" data-path="reading-data.html"><a href="reading-data.html"><i class="fa fa-check"></i><b>5</b> Reading data</a></li>
<li class="chapter" data-level="6" data-path="general-data-manipulation.html"><a href="general-data-manipulation.html"><i class="fa fa-check"></i><b>6</b> General data manipulation</a></li>
<li class="chapter" data-level="7" data-path="thats-too-much-data.html"><a href="thats-too-much-data.html"><i class="fa fa-check"></i><b>7</b> That’s <em>too much</em> data</a></li>
<li class="chapter" data-level="8" data-path="the-pipe.html"><a href="the-pipe.html"><i class="fa fa-check"></i><b>8</b> The pipe <code>%&gt;%</code></a></li>
<li class="chapter" data-level="9" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>9</b> Data Structures</a></li>
<li class="chapter" data-level="10" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>10</b> Summary statistics</a></li>
<li class="chapter" data-level="11" data-path="summarizing-the-tidy-way.html"><a href="summarizing-the-tidy-way.html"><i class="fa fa-check"></i><b>11</b> summarizing the tidy way</a></li>
<li class="part"><span><b>II Vizualization Strategies</b></span></li>
<li class="chapter" data-level="12" data-path="layered-i.html"><a href="layered-i.html"><i class="fa fa-check"></i><b>12</b> Grammer of layered graphics I</a></li>
<li class="chapter" data-level="13" data-path="visualizing-trends-and-relationships.html"><a href="visualizing-trends-and-relationships.html"><i class="fa fa-check"></i><b>13</b> Visualizing Trends and Relationships</a></li>
<li class="chapter" data-level="14" data-path="grammer-of-layered-graphics-ii.html"><a href="grammer-of-layered-graphics-ii.html"><i class="fa fa-check"></i><b>14</b> Grammer of layered graphics II</a></li>
<li class="chapter" data-level="15" data-path="visualizing-beyond-2-dimensions.html"><a href="visualizing-beyond-2-dimensions.html"><i class="fa fa-check"></i><b>15</b> Visualizing beyond 2-dimensions</a></li>
<li class="part"><span><b>III More than hammer and nails</b></span></li>
<li class="chapter" data-level="16" data-path="multiple-data-sets.html"><a href="multiple-data-sets.html"><i class="fa fa-check"></i><b>16</b> Multiple data sets</a></li>
<li class="chapter" data-level="17" data-path="spatial-analysis.html"><a href="spatial-analysis.html"><i class="fa fa-check"></i><b>17</b> Spatial Analysis</a></li>
<li class="chapter" data-level="18" data-path="creating-ecometrics.html"><a href="creating-ecometrics.html"><i class="fa fa-check"></i><b>18</b> Creating Ecometrics</a></li>
<li class="part"><span><b>IV Case Studies</b></span></li>
<li class="chapter" data-level="19" data-path="case-study-twitter-data.html"><a href="case-study-twitter-data.html"><i class="fa fa-check"></i><b>19</b> Case Study: Twitter Data</a></li>
<li class="chapter" data-level="20" data-path="various-things-that-i-didnt-cover-well.html"><a href="various-things-that-i-didnt-cover-well.html"><i class="fa fa-check"></i><b>20</b> Various things that i didn’t cover well</a></li>
<li class="chapter" data-level="21" data-path="schools-of-urban-informatics.html"><a href="schools-of-urban-informatics.html"><i class="fa fa-check"></i><b>21</b> Schools of Urban Informatics</a></li>
<li class="chapter" data-level="22" data-path="broken-windows-and-the-origin-of-ecometrics.html"><a href="broken-windows-and-the-origin-of-ecometrics.html"><i class="fa fa-check"></i><b>22</b> Broken Windows and the origin of Ecometrics</a></li>
<li class="divider"></li>
<li><a href="https://github.com/josiahparry/urban-informatics-toolkit" target="blank">GitHub</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Urban Informatics Toolkit</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multiple-data-sets" class="section level1">
<h1><span class="header-section-number">Chapter 16</span> Multiple data sets</h1>
<p>Many times working with just one data set will not suffice. More often than not the data that we will be working with be will need to be supplemented by other data sets. These datasets have a shared relation which are what enables us to <strong>join</strong> them together. A join is a way of combining the columns between two sets of data while ensuring the rows are properly aligned.</p>
<p>The relationship that joins these tables together are expressed in the data through what is called a <strong>common identifier</strong>. This a variable exists in both datasets—perhaps, with a different name—and can be used as a reference to associate rows from each table together.</p>
<p>Recall to our definition of tidy data. The definition that we used characterized the data inside of a single table. There is actually another rule: “each observational unit forms a table.” So, in our previous definition a row was a single observation. When we extend the definition as such this is still the case but we have to create distinctions between “observational units[s].”</p>
<p>To explore this concept we will use data about Airbnb listings in Boston. These data come from <a href="http://insideairbnb.com">Inside Airbnb</a>. Inside Airbnb collects Airbnb’s public listing and makes them available through a “non-commercial set of tools and data that allows you to explore how Airbnb is really being used in cities around the world” (<a href="http://insideairbnb.com/about.html" class="uri">http://insideairbnb.com/about.html</a>).</p>
<p>Inside Airbnb data are another example of harnessing naturally occurring data. The listings are not generated with the intent of <em>being</em> data, but by the virtue of their existence, they become data. We are able to harness them to learn about the shifting neighborhood dynamic of cities. They can tell us something about short term rentals in a locale and about where people may be visiting and when.</p>
<p>We will first look at two data sets: <code>listings</code>, and <code>hosts</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="multiple-data-sets.html#cb1-1"></a>listings &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/airbnb/listings.csv&quot;</span>)</span>
<span id="cb1-2"><a href="multiple-data-sets.html#cb1-2"></a></span>
<span id="cb1-3"><a href="multiple-data-sets.html#cb1-3"></a><span class="kw">glimpse</span>(listings)</span>
<span id="cb1-4"><a href="multiple-data-sets.html#cb1-4"></a><span class="co">## Observations: 3,799</span></span>
<span id="cb1-5"><a href="multiple-data-sets.html#cb1-5"></a><span class="co">## Variables: 7</span></span>
<span id="cb1-6"><a href="multiple-data-sets.html#cb1-6"></a><span class="co">## $ neighborhood     &lt;chr&gt; &quot;East Boston&quot;, &quot;Roxbury&quot;, &quot;Roxbury&quot;, &quot;Downtown&quot;…</span></span>
<span id="cb1-7"><a href="multiple-data-sets.html#cb1-7"></a><span class="co">## $ room_type        &lt;chr&gt; &quot;Entire home/apt&quot;, &quot;Entire home/apt&quot;, &quot;Entire h…</span></span>
<span id="cb1-8"><a href="multiple-data-sets.html#cb1-8"></a><span class="co">## $ price            &lt;dbl&gt; 125, 145, 169, 99, 150, 179, 125, 50, 154, 115,…</span></span>
<span id="cb1-9"><a href="multiple-data-sets.html#cb1-9"></a><span class="co">## $ minimum_nights   &lt;dbl&gt; 28, 3, 3, 91, 91, 91, 91, 91, 29, 1, 2, 2, 2, 6…</span></span>
<span id="cb1-10"><a href="multiple-data-sets.html#cb1-10"></a><span class="co">## $ n_reviews        &lt;dbl&gt; 16, 106, 115, 24, 31, 80, 2, 0, 52, 21, 316, 10…</span></span>
<span id="cb1-11"><a href="multiple-data-sets.html#cb1-11"></a><span class="co">## $ availability_365 &lt;dbl&gt; 68, 322, 274, 247, 29, 0, 364, 365, 304, 285, 6…</span></span>
<span id="cb1-12"><a href="multiple-data-sets.html#cb1-12"></a><span class="co">## $ host_id          &lt;dbl&gt; 4804, 8229, 8229, 26988, 26988, 38997, 38997, 2…</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="multiple-data-sets.html#cb2-1"></a>hosts &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/airbnb/hosts.csv&quot;</span>)</span>
<span id="cb2-2"><a href="multiple-data-sets.html#cb2-2"></a></span>
<span id="cb2-3"><a href="multiple-data-sets.html#cb2-3"></a><span class="kw">glimpse</span>(hosts)</span>
<span id="cb2-4"><a href="multiple-data-sets.html#cb2-4"></a><span class="co">## Observations: 1,335</span></span>
<span id="cb2-5"><a href="multiple-data-sets.html#cb2-5"></a><span class="co">## Variables: 9</span></span>
<span id="cb2-6"><a href="multiple-data-sets.html#cb2-6"></a><span class="co">## $ id                 &lt;dbl&gt; 4804, 8229, 26988, 38997, 23078, 71783, 85130…</span></span>
<span id="cb2-7"><a href="multiple-data-sets.html#cb2-7"></a><span class="co">## $ name               &lt;chr&gt; &quot;Frank&quot;, &quot;Terry&quot;, &quot;Anne&quot;, &quot;Michelle&quot;, &quot;Eric&quot;,…</span></span>
<span id="cb2-8"><a href="multiple-data-sets.html#cb2-8"></a><span class="co">## $ since_year         &lt;dbl&gt; 2008, 2009, 2009, 2009, 2009, 2010, 2010, 201…</span></span>
<span id="cb2-9"><a href="multiple-data-sets.html#cb2-9"></a><span class="co">## $ since_month        &lt;chr&gt; &quot;12&quot;, &quot;02&quot;, &quot;07&quot;, &quot;09&quot;, &quot;06&quot;, &quot;01&quot;, &quot;02&quot;, &quot;02…</span></span>
<span id="cb2-10"><a href="multiple-data-sets.html#cb2-10"></a><span class="co">## $ since_day          &lt;chr&gt; &quot;03&quot;, &quot;19&quot;, &quot;22&quot;, &quot;16&quot;, &quot;24&quot;, &quot;19&quot;, &quot;24&quot;, &quot;26…</span></span>
<span id="cb2-11"><a href="multiple-data-sets.html#cb2-11"></a><span class="co">## $ host_response_rate &lt;chr&gt; &quot;100%&quot;, &quot;100%&quot;, &quot;100%&quot;, &quot;92%&quot;, &quot;50%&quot;, &quot;98%&quot;, …</span></span>
<span id="cb2-12"><a href="multiple-data-sets.html#cb2-12"></a><span class="co">## $ acceptance_rate    &lt;chr&gt; &quot;50%&quot;, &quot;100%&quot;, &quot;84%&quot;, &quot;17%&quot;, &quot;N/A&quot;, &quot;98%&quot;, &quot;9…</span></span>
<span id="cb2-13"><a href="multiple-data-sets.html#cb2-13"></a><span class="co">## $ superhost          &lt;dbl&gt; 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, …</span></span>
<span id="cb2-14"><a href="multiple-data-sets.html#cb2-14"></a><span class="co">## $ n_listings         &lt;dbl&gt; 5, 2, 9, 13, 3, 40, 7, 4, 1, 2, 1, 1, 5, 1, 1…</span></span></code></pre></div>
<p>Notice that the each row of the table is an observation of a different phenomenon. Each observation in <code>listings</code> is rentable dwelling and each row in <code>hosts</code> is a different individual. One host may have multiple listings as illustrated by the <code>n_listings</code> column. This sort of relationship is called <em>one to many</em> meaning that for each host there is one or more listings. This is rather evident in the number of observations in each table—3,799 and 1,335 respectively.</p>
<p>To associate the host information with the listings information we need to join the two datasets together. Most often the common identifier will be a type of id (often referred to as keys). Identifiers are meant to be unique at the observational unit. If we look at the variables of our tibbles we notice that <code>listings</code> contains <code>host_id</code> and <code>hosts</code> an <code>id</code> column. Fortunately the first two rows of each dataset share identifiers.</p>
<p>Before we get to joining our datasets, we need to understand the different types of joins that are available to us. When doing joins we consider two tables: one on the left hand side and the other on the right hand side referred to in documentation as <em>x</em> and <em>y</em> respectively. There are a plethora of joins that are possible but I want to keep the focus to four types. These are the left, right, inner, and anti joins.</p>
<p>The left and right join are identical, the only difference is which table we may consider the target of the join. In the case of the left join, it will</p>
<blockquote>
<p>“return all rows from x, and all columns from x and y. Rows in x with no match in y will have NA [missing] values in the new columns. If there are multiple matches between x and y, all combinations of the matches are returned.”</p>
</blockquote>
<p>Simply, in a left join we will never lose rows from x. If there happens to be no match from y there will be missing values. The reverse is true for the right join. A right join ensures that all rows from y will remain at the end. If there are duplicate matches between x and y each of those will be returned.</p>
<p>For the sake of example, let’s reduce our data down to the first five rows and only a few columns for each. Hosts data will be stored in the tibble <code>h</code> and listings in <code>l</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="multiple-data-sets.html#cb3-1"></a>h &lt;-<span class="st"> </span><span class="kw">slice</span>(hosts, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-2"><a href="multiple-data-sets.html#cb3-2"></a><span class="st">  </span><span class="kw">select</span>(id, name, n_listings)</span>
<span id="cb3-3"><a href="multiple-data-sets.html#cb3-3"></a></span>
<span id="cb3-4"><a href="multiple-data-sets.html#cb3-4"></a>l &lt;-<span class="st"> </span><span class="kw">slice</span>(listings, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-5"><a href="multiple-data-sets.html#cb3-5"></a><span class="st">  </span><span class="kw">select</span>(host_id, price, neighborhood)</span>
<span id="cb3-6"><a href="multiple-data-sets.html#cb3-6"></a></span>
<span id="cb3-7"><a href="multiple-data-sets.html#cb3-7"></a>h</span>
<span id="cb3-8"><a href="multiple-data-sets.html#cb3-8"></a><span class="co">## # A tibble: 5 x 3</span></span>
<span id="cb3-9"><a href="multiple-data-sets.html#cb3-9"></a><span class="co">##      id name     n_listings</span></span>
<span id="cb3-10"><a href="multiple-data-sets.html#cb3-10"></a><span class="co">##   &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;</span></span>
<span id="cb3-11"><a href="multiple-data-sets.html#cb3-11"></a><span class="co">## 1  4804 Frank             5</span></span>
<span id="cb3-12"><a href="multiple-data-sets.html#cb3-12"></a><span class="co">## 2  8229 Terry             2</span></span>
<span id="cb3-13"><a href="multiple-data-sets.html#cb3-13"></a><span class="co">## 3 26988 Anne              9</span></span>
<span id="cb3-14"><a href="multiple-data-sets.html#cb3-14"></a><span class="co">## 4 38997 Michelle         13</span></span>
<span id="cb3-15"><a href="multiple-data-sets.html#cb3-15"></a><span class="co">## 5 23078 Eric              3</span></span>
<span id="cb3-16"><a href="multiple-data-sets.html#cb3-16"></a>l</span>
<span id="cb3-17"><a href="multiple-data-sets.html#cb3-17"></a><span class="co">## # A tibble: 5 x 3</span></span>
<span id="cb3-18"><a href="multiple-data-sets.html#cb3-18"></a><span class="co">##   host_id price neighborhood</span></span>
<span id="cb3-19"><a href="multiple-data-sets.html#cb3-19"></a><span class="co">##     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       </span></span>
<span id="cb3-20"><a href="multiple-data-sets.html#cb3-20"></a><span class="co">## 1    4804   125 East Boston </span></span>
<span id="cb3-21"><a href="multiple-data-sets.html#cb3-21"></a><span class="co">## 2    8229   145 Roxbury     </span></span>
<span id="cb3-22"><a href="multiple-data-sets.html#cb3-22"></a><span class="co">## 3    8229   169 Roxbury     </span></span>
<span id="cb3-23"><a href="multiple-data-sets.html#cb3-23"></a><span class="co">## 4   26988    99 Downtown    </span></span>
<span id="cb3-24"><a href="multiple-data-sets.html#cb3-24"></a><span class="co">## 5   26988   150 Downtown</span></span></code></pre></div>
<p>In <code>h</code> we have one observation per host meaning that there are 5 distinct hosts in our dataset. In general when there is only one id per observation for a table, that is generally referred to as the <strong>primary key</strong> as it is used to identify observations in that table. In this case, <code>id</code> is the primary key for <code>h</code>. Whereas when we look to <code>l</code>, there are multiple observations for the <code>host_id</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="multiple-data-sets.html#cb4-1"></a><span class="kw">count</span>(l, host_id)</span>
<span id="cb4-2"><a href="multiple-data-sets.html#cb4-2"></a><span class="co">## # A tibble: 3 x 2</span></span>
<span id="cb4-3"><a href="multiple-data-sets.html#cb4-3"></a><span class="co">##   host_id     n</span></span>
<span id="cb4-4"><a href="multiple-data-sets.html#cb4-4"></a><span class="co">##     &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb4-5"><a href="multiple-data-sets.html#cb4-5"></a><span class="co">## 1    4804     1</span></span>
<span id="cb4-6"><a href="multiple-data-sets.html#cb4-6"></a><span class="co">## 2    8229     2</span></span>
<span id="cb4-7"><a href="multiple-data-sets.html#cb4-7"></a><span class="co">## 3   26988     2</span></span></code></pre></div>
<p>When the ID is used to identify observations in another table, that is referred to as the <strong>foreign key</strong>. Here, <code>host_id</code> is used to connect <code>l</code> to the <code>h</code> table and as such is a foreign key.</p>
<p>Say we want to know all of the host information associated with each listing we will need to join <code>h</code> to <code>l</code>. In this situations we want to keep all records of listings and only keep the host information when it is relevant. A left join with <code>l</code> as the left hand table and <code>h</code> as the right hand table will provide us with exactly what we need.</p>
<p>To actually perform the join, we will use the function <code>left_join()</code> from dplyr. There are three arguments that we need to fulfill: <code>x</code>, <code>y</code>, and <code>by</code>. That is, what table will be on our left and which will be on the right? And, which column(s) will act as the common identifier.</p>
<p>Fulfilling the <code>x</code> and <code>y</code> arguments is straightforward, we simply supply the relevant tibbles. Marking the common identifier is a little bit tricky. <code>by</code> expects a character vector with the name of the common identifier. However, in most cases, the column names will differ by table. To connect them we need to create what is called a named vector.</p>
<p>In general we create a vector with <code>c()</code> and each element is separated by a comma. If we were to create a vector with the names of our identifier (from left to right) it would look like</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="multiple-data-sets.html#cb5-1"></a><span class="kw">c</span>(<span class="st">&quot;host_id&quot;</span>, <span class="st">&quot;id&quot;</span>)</span>
<span id="cb5-2"><a href="multiple-data-sets.html#cb5-2"></a><span class="co">## [1] &quot;host_id&quot; &quot;id&quot;</span></span></code></pre></div>
<p>This is a vector of length 2. We need to create a vector of length 1 where the only element is named. We can name vector elements like <code>c("element_name" = "element")</code>. For <code>left_join()</code> the name of the element is the identifier in the left hand table and the element is the name of identifier in the right hand table. Putting this all together it looks like</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="multiple-data-sets.html#cb6-1"></a><span class="kw">c</span>(<span class="st">&quot;host_id&quot;</span> =<span class="st"> &quot;id&quot;</span>)</span>
<span id="cb6-2"><a href="multiple-data-sets.html#cb6-2"></a><span class="co">## host_id </span></span>
<span id="cb6-3"><a href="multiple-data-sets.html#cb6-3"></a><span class="co">##    &quot;id&quot;</span></span></code></pre></div>
<p>Now we have all of the pieces that we need and can perform the join.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="multiple-data-sets.html#cb7-1"></a><span class="kw">left_join</span>(l, h, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;host_id&quot;</span> =<span class="st"> &quot;id&quot;</span>))</span>
<span id="cb7-2"><a href="multiple-data-sets.html#cb7-2"></a><span class="co">## # A tibble: 5 x 5</span></span>
<span id="cb7-3"><a href="multiple-data-sets.html#cb7-3"></a><span class="co">##   host_id price neighborhood name  n_listings</span></span>
<span id="cb7-4"><a href="multiple-data-sets.html#cb7-4"></a><span class="co">##     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt;</span></span>
<span id="cb7-5"><a href="multiple-data-sets.html#cb7-5"></a><span class="co">## 1    4804   125 East Boston  Frank          5</span></span>
<span id="cb7-6"><a href="multiple-data-sets.html#cb7-6"></a><span class="co">## 2    8229   145 Roxbury      Terry          2</span></span>
<span id="cb7-7"><a href="multiple-data-sets.html#cb7-7"></a><span class="co">## 3    8229   169 Roxbury      Terry          2</span></span>
<span id="cb7-8"><a href="multiple-data-sets.html#cb7-8"></a><span class="co">## 4   26988    99 Downtown     Anne           9</span></span>
<span id="cb7-9"><a href="multiple-data-sets.html#cb7-9"></a><span class="co">## 5   26988   150 Downtown     Anne           9</span></span></code></pre></div>
<p>There are no missing values in this join because each <code>host_id</code> had a counter-part in the host table. Now, say we perform right join but keep our tables exactly where they are. What do you expect this to look like?</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="multiple-data-sets.html#cb8-1"></a><span class="kw">right_join</span>(l, h, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;host_id&quot;</span> =<span class="st"> &quot;id&quot;</span>))</span>
<span id="cb8-2"><a href="multiple-data-sets.html#cb8-2"></a><span class="co">## # A tibble: 7 x 5</span></span>
<span id="cb8-3"><a href="multiple-data-sets.html#cb8-3"></a><span class="co">##   host_id price neighborhood name     n_listings</span></span>
<span id="cb8-4"><a href="multiple-data-sets.html#cb8-4"></a><span class="co">##     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;         &lt;dbl&gt;</span></span>
<span id="cb8-5"><a href="multiple-data-sets.html#cb8-5"></a><span class="co">## 1    4804   125 East Boston  Frank             5</span></span>
<span id="cb8-6"><a href="multiple-data-sets.html#cb8-6"></a><span class="co">## 2    8229   145 Roxbury      Terry             2</span></span>
<span id="cb8-7"><a href="multiple-data-sets.html#cb8-7"></a><span class="co">## 3    8229   169 Roxbury      Terry             2</span></span>
<span id="cb8-8"><a href="multiple-data-sets.html#cb8-8"></a><span class="co">## 4   26988    99 Downtown     Anne              9</span></span>
<span id="cb8-9"><a href="multiple-data-sets.html#cb8-9"></a><span class="co">## 5   26988   150 Downtown     Anne              9</span></span>
<span id="cb8-10"><a href="multiple-data-sets.html#cb8-10"></a><span class="co">## 6   38997    NA &lt;NA&gt;         Michelle         13</span></span>
<span id="cb8-11"><a href="multiple-data-sets.html#cb8-11"></a><span class="co">## 7   23078    NA &lt;NA&gt;         Eric              3</span></span></code></pre></div>
<p>There are two key differences here. The first is that, since the right hand table has unmatched <code>id</code>s, we should anticipate missing values in the columns from <code>l</code>—<code>price</code> and <code>neighborhood</code>. Moreover, since there are multiple matches in the left hand table, we are returned more than observation per match.</p>
<p>This naturally brings us to the inner join. The inner join will <em>only</em> return row where there are matching observations in <em>both</em> tables.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="multiple-data-sets.html#cb9-1"></a><span class="kw">inner_join</span>(l, h, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;host_id&quot;</span> =<span class="st"> &quot;id&quot;</span>))</span>
<span id="cb9-2"><a href="multiple-data-sets.html#cb9-2"></a><span class="co">## # A tibble: 5 x 5</span></span>
<span id="cb9-3"><a href="multiple-data-sets.html#cb9-3"></a><span class="co">##   host_id price neighborhood name  n_listings</span></span>
<span id="cb9-4"><a href="multiple-data-sets.html#cb9-4"></a><span class="co">##     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt;</span></span>
<span id="cb9-5"><a href="multiple-data-sets.html#cb9-5"></a><span class="co">## 1    4804   125 East Boston  Frank          5</span></span>
<span id="cb9-6"><a href="multiple-data-sets.html#cb9-6"></a><span class="co">## 2    8229   145 Roxbury      Terry          2</span></span>
<span id="cb9-7"><a href="multiple-data-sets.html#cb9-7"></a><span class="co">## 3    8229   169 Roxbury      Terry          2</span></span>
<span id="cb9-8"><a href="multiple-data-sets.html#cb9-8"></a><span class="co">## 4   26988    99 Downtown     Anne           9</span></span>
<span id="cb9-9"><a href="multiple-data-sets.html#cb9-9"></a><span class="co">## 5   26988   150 Downtown     Anne           9</span></span></code></pre></div>
<p>Oftentimes, as with this time, the inner join behaves much like a left or right join where one of the tables has each observation matched. In general I recommend performing left or right joins so we can better keep track of missingness.</p>
<p>The last join to cover is the anti join. The anti join is rather unique and is used to find where there are <em>not</em> matches between two tables. When using an anti join we are returned all observations from x where there are <em>not</em> matches in y. From our previous right join, we know that there are not matches for two of the host ids in <code>h</code>. To find these using a join we can put <code>h</code> in the x position and <code>l</code> in the y position. Note that since we are switching the order of our tibbles we need to rearrange the vector we supplied to <code>by</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="multiple-data-sets.html#cb10-1"></a><span class="kw">anti_join</span>(h, l, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span> =<span class="st"> &quot;host_id&quot;</span>))</span>
<span id="cb10-2"><a href="multiple-data-sets.html#cb10-2"></a><span class="co">## # A tibble: 2 x 3</span></span>
<span id="cb10-3"><a href="multiple-data-sets.html#cb10-3"></a><span class="co">##      id name     n_listings</span></span>
<span id="cb10-4"><a href="multiple-data-sets.html#cb10-4"></a><span class="co">##   &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;</span></span>
<span id="cb10-5"><a href="multiple-data-sets.html#cb10-5"></a><span class="co">## 1 38997 Michelle         13</span></span>
<span id="cb10-6"><a href="multiple-data-sets.html#cb10-6"></a><span class="co">## 2 23078 Eric              3</span></span></code></pre></div>
<p>If we reverse this, we should receive an empty tibble.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="multiple-data-sets.html#cb11-1"></a><span class="kw">anti_join</span>(l, h, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;host_id&quot;</span> =<span class="st"> &quot;id&quot;</span>))</span>
<span id="cb11-2"><a href="multiple-data-sets.html#cb11-2"></a><span class="co">## # A tibble: 0 x 3</span></span>
<span id="cb11-3"><a href="multiple-data-sets.html#cb11-3"></a><span class="co">## # … with 3 variables: host_id &lt;dbl&gt;, price &lt;dbl&gt;, neighborhood &lt;chr&gt;</span></span></code></pre></div>
<p>Anti joins are often a good way to sanity check your data when looking for completeness or missingness. Be sure to keep this one in your back pocket!</p>
<div id="exercise-3" class="section level2">
<h2><span class="header-section-number">16.1</span> Exercise</h2>
<p>For this exercise your goal is to identify the average price and availability of Airbnb rentals by host. Then plot</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="multiple-data-sets.html#cb12-1"></a>host_summary &lt;-<span class="st"> </span><span class="kw">left_join</span>(listings, hosts, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;host_id&quot;</span> =<span class="st"> &quot;id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-2"><a href="multiple-data-sets.html#cb12-2"></a><span class="st">  </span><span class="kw">group_by</span>(superhost) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-3"><a href="multiple-data-sets.html#cb12-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_avail =</span> <span class="kw">mean</span>(availability_<span class="dv">365</span>),</span>
<span id="cb12-4"><a href="multiple-data-sets.html#cb12-4"></a>            <span class="dt">avg_price =</span> <span class="kw">mean</span>(price),</span>
<span id="cb12-5"><a href="multiple-data-sets.html#cb12-5"></a>            <span class="dt">avg_min_nights =</span> <span class="kw">mean</span>(minimum_nights))</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualizing-beyond-2-dimensions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spatial-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["urban-commons-toolkit.pdf", "urban-commons-toolkit.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
