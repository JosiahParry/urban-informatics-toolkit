<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 24 Multiple data sets | Urban Informatics Toolkit</title>
<meta name="author" content="Josiah Parry">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.5.3/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Urban Informatics Toolkit</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome</a></li>
<li class="book-part">Foundations of Urban Informatics</li>
<li><a class="" href="the-utility-and-danger-of-big-data.html"><span class="header-section-number">2</span> The Utility and Danger of Big Data</a></li>
<li><a class="" href="data-in-the-municipal-context.html"><span class="header-section-number">3</span> Data in the municipal context</a></li>
<li><a class="" href="approaches-to-and-schools-of-urban-informatics.html"><span class="header-section-number">4</span> Approaches to and Schools of Urban Informatics</a></li>
<li><a class="" href="ecometrics.html"><span class="header-section-number">5</span> Ecometrics</a></li>
<li class="book-part">Toolkit Foundations</li>
<li><a class="" href="the-basics.html"><span class="header-section-number">6</span> The basics</a></li>
<li><a class="" href="r-as-a-calculator.html"><span class="header-section-number">7</span> R as a calculator</a></li>
<li><a class="" href="reading-data.html"><span class="header-section-number">8</span> Reading data</a></li>
<li><a class="" href="exploratory-visual-analysis.html"><span class="header-section-number">9</span> Exploratory Visual Analysis</a></li>
<li><a class="" href="general-data-manipulation.html"><span class="header-section-number">10</span> General data manipulation</a></li>
<li><a class="" href="thats-too-much-data.html"><span class="header-section-number">11</span> That’s too much data</a></li>
<li><a class="" href="the-pipe.html"><span class="header-section-number">12</span> The pipe %&gt;%</a></li>
<li><a class="" href="creating-new-measures.html"><span class="header-section-number">13</span> Creating new measures</a></li>
<li><a class="" href="data-structures.html"><span class="header-section-number">14</span> Data Structures</a></li>
<li><a class="" href="summary-statistics.html"><span class="header-section-number">15</span> Summary statistics</a></li>
<li><a class="" href="summarizing-the-tidy-way.html"><span class="header-section-number">16</span> Summarizing the tidy way</a></li>
<li><a class="" href="toolkit-review.html"><span class="header-section-number">17</span> Toolkit review</a></li>
<li class="book-part">Vizualization Strategies</li>
<li><a class="" href="layered-i.html"><span class="header-section-number">18</span> Grammar of layered graphics I</a></li>
<li><a class="" href="visualizing-trends-and-relationships.html"><span class="header-section-number">19</span> Visualizing Trends and Relationships</a></li>
<li><a class="" href="grammer-of-layered-graphics-ii.html"><span class="header-section-number">20</span> Grammer of layered graphics II</a></li>
<li><a class="" href="visualizing-beyond-2-dimensions.html"><span class="header-section-number">21</span> Visualizing beyond 2-dimensions</a></li>
<li><a class="" href="visualizing-through-time.html"><span class="header-section-number">22</span> Visualizing through time</a></li>
<li><a class="" href="visualization-review.html"><span class="header-section-number">23</span> Visualization Review</a></li>
<li class="book-part">Expanding the Toolkit</li>
<li><a class="active" href="multiple-data-sets.html"><span class="header-section-number">24</span> Multiple data sets</a></li>
<li><a class="" href="statistics.html"><span class="header-section-number">25</span> Statistics</a></li>
<li><a class="" href="spatial-analysis.html"><span class="header-section-number">26</span> Spatial Analysis</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="multiple-data-sets" class="section level1" number="24">
<h1>
<span class="header-section-number">24</span> Multiple data sets<a class="anchor" aria-label="anchor" href="#multiple-data-sets"><i class="fas fa-link"></i></a>
</h1>
<p>Many times working with just one data set will not suffice. More often than not the data that we will be working with be will need to be supplemented by other data sets. These datasets have a shared relation which are what enables us to <strong>join</strong> them together. A join is a way of combining the columns between two sets of data while ensuring the rows are properly aligned.</p>
<p>The relationship that joins these tables together are expressed in the data through what is called a <strong>common identifier</strong>. This a variable exists in both datasets—perhaps, with a different name—and can be used as a reference to associate rows from each table together.</p>
<p>Recall to our definition of tidy data. The definition that we used characterized the data inside of a single table. There is actually another rule: “each observational unit forms a table.” So, in our previous definition a row was a single observation. When we extend the definition as such this is still the case but we have to create distinctions between “observational units[s].”</p>
<p>To explore this concept we will use data about Airbnb listings in Boston. These data come from <a href="http://insideairbnb.com">Inside Airbnb</a>. Inside Airbnb collects Airbnb’s public listing and makes them available through a “non-commercial set of tools and data that allows you to explore how Airbnb is really being used in cities around the world”<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Inside Airbnb. &lt;a href="http://insideairbnb.com/about.html" class="uri"&gt;http://insideairbnb.com/about.html&lt;/a&gt;.&lt;/p&gt;'><sup>73</sup></a>.</p>
<p>Inside Airbnb data are another example of harnessing naturally occurring data. The listings are not generated with the intent of <em>being</em> data, but by the virtue of their existence, they become data. We are able to harness them to learn about the shifting neighborhood dynamic of cities. They can tell us something about short term rentals in a locale and about where people may be visiting and when.</p>
<p>We will first look at two data sets: <code>listings</code>, and <code>hosts</code>.</p>
<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">uitk</span><span class="op">)</span>

<span class="va">listings</span> <span class="op">&lt;-</span> <span class="fu">uitk</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/uitk/man/airbnb_listings.html">airbnb_listings</a></span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">listings</span><span class="op">)</span>
<span class="co">#&gt; Rows: 3,799</span>
<span class="co">#&gt; Columns: 7</span>
<span class="co">#&gt; $ id               &lt;dbl&gt; 3781, 5506, 6695, 8789, 10730, 10813, 10986, 16384, …</span>
<span class="co">#&gt; $ neighborhood     &lt;chr&gt; "East Boston", "Roxbury", "Roxbury", "Downtown", "Do…</span>
<span class="co">#&gt; $ room_type        &lt;chr&gt; "Entire home/apt", "Entire home/apt", "Entire home/a…</span>
<span class="co">#&gt; $ price            &lt;dbl&gt; 125, 145, 169, 99, 150, 179, 125, 50, 154, 115, 148,…</span>
<span class="co">#&gt; $ minimum_nights   &lt;dbl&gt; 28, 3, 3, 91, 91, 91, 91, 91, 29, 1, 2, 2, 2, 6, 3, …</span>
<span class="co">#&gt; $ availability_365 &lt;dbl&gt; 68, 322, 274, 247, 29, 0, 364, 365, 304, 285, 62, 24…</span>
<span class="co">#&gt; $ host_id          &lt;dbl&gt; 4804, 8229, 8229, 26988, 26988, 38997, 38997, 23078,…</span></code></pre></div>
<div class="sourceCode" id="cb283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hosts</span> <span class="op">&lt;-</span> <span class="fu">uitk</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/uitk/man/airbnb_hosts.html">airbnb_hosts</a></span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">hosts</span><span class="op">)</span>
<span class="co">#&gt; Rows: 1,335</span>
<span class="co">#&gt; Columns: 9</span>
<span class="co">#&gt; $ id              &lt;dbl&gt; 4804, 8229, 26988, 38997, 23078, 71783, 85130, 85770,…</span>
<span class="co">#&gt; $ name            &lt;chr&gt; "Frank", "Terry", "Anne", "Michelle", "Eric", "Lance"…</span>
<span class="co">#&gt; $ since_year      &lt;dbl&gt; 2008, 2009, 2009, 2009, 2009, 2010, 2010, 2010, 2010,…</span>
<span class="co">#&gt; $ since_month     &lt;chr&gt; "12", "02", "07", "09", "06", "01", "02", "02", "03",…</span>
<span class="co">#&gt; $ since_day       &lt;chr&gt; "03", "19", "22", "16", "24", "19", "24", "26", "23",…</span>
<span class="co">#&gt; $ response_rate   &lt;chr&gt; "100%", "100%", "100%", "92%", "50%", "98%", "66%", "…</span>
<span class="co">#&gt; $ acceptance_rate &lt;chr&gt; "50%", "100%", "84%", "17%", NA, "98%", "97%", "100%"…</span>
<span class="co">#&gt; $ superhost       &lt;dbl&gt; 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1,…</span>
<span class="co">#&gt; $ n_listings      &lt;dbl&gt; 5, 2, 9, 13, 3, 40, 7, 4, 1, 2, 1, 1, 5, 1, 1, 1, 1, …</span></code></pre></div>
<p>Notice that the each row of the table is an observation of a different phenomenon. Each observation in <code>listings</code> is rentable dwelling and each row in <code>hosts</code> is a different individual. One host may have multiple listings. This sort of relationship is called <em>one to many</em> meaning that for each host there is one or more listings. This is rather evident in the number of observations in each table—3,799 and 1,335 respectively.</p>
<p>To associate the host information with the listings information we need to join the two datasets together. Most often the common identifier will be a type of id (often referred to as keys). Identifiers are meant to be unique at the observational unit. If we look at the variables of our tibbles we notice that <code>listings</code> contains <code>host_id</code> and <code>hosts</code> an <code>id</code> column. Fortunately the first two rows of each dataset share identifiers.</p>
<p>Before we get to joining our datasets, we need to understand the different types of joins that are available to us. When doing joins we consider two tables: one on the left hand side and the other on the right hand side referred to in documentation as <em>x</em> and <em>y</em> respectively. There are a plethora of joins that are possible but I want to keep the focus to four types. These are the left, right, inner, and anti joins.</p>
<p>The left and right join are identical, the only difference is which table we may consider the target of the join. In the case of the left join, it will</p>
<blockquote>
<p>“return all rows from x, and all columns from x and y. Rows in x with no match in y will have NA [missing] values in the new columns. If there are multiple matches between x and y, all combinations of the matches are returned.”</p>
</blockquote>
<p>Simply, in a left join we will never lose rows from x. If there happens to be no match from y there will be missing values. The reverse is true for the right join. A right join ensures that all rows from y will remain at the end. If there are duplicate matches between x and y each of those will be returned.</p>
<p>For the sake of example, let’s reduce our data down to the first five rows and only a few columns for each. Hosts data will be stored in the tibble <code>h</code> and listings in <code>l</code>.</p>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">hosts</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">name</span>, <span class="va">n_listings</span><span class="op">)</span>

<span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">listings</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">host_id</span>, <span class="va">price</span>, <span class="va">neighborhood</span><span class="op">)</span>

<span class="va">h</span>
<span class="co">#&gt; # A tibble: 5 x 3</span>
<span class="co">#&gt;      id name     n_listings</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1  4804 Frank             5</span>
<span class="co">#&gt; 2  8229 Terry             2</span>
<span class="co">#&gt; 3 26988 Anne              9</span>
<span class="co">#&gt; 4 38997 Michelle         13</span>
<span class="co">#&gt; 5 23078 Eric              3</span>
<span class="va">l</span>
<span class="co">#&gt; # A tibble: 5 x 3</span>
<span class="co">#&gt;   host_id price neighborhood</span>
<span class="co">#&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       </span>
<span class="co">#&gt; 1    4804   125 East Boston </span>
<span class="co">#&gt; 2    8229   145 Roxbury     </span>
<span class="co">#&gt; 3    8229   169 Roxbury     </span>
<span class="co">#&gt; 4   26988    99 Downtown    </span>
<span class="co">#&gt; 5   26988   150 Downtown</span></code></pre></div>
<p>In <code>h</code> we have one observation per host meaning that there are 5 distinct hosts in our dataset. In general when there is only one id per observation for a table, that is generally referred to as the <strong>primary key</strong> as it is used to identify observations in that table. In this case, <code>id</code> is the primary key for <code>h</code>. Whereas when we look to <code>l</code>, there are multiple observations for the <code>host_id</code>.</p>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">host_id</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   host_id     n</span>
<span class="co">#&gt;     &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1    4804     1</span>
<span class="co">#&gt; 2    8229     2</span>
<span class="co">#&gt; 3   26988     2</span></code></pre></div>
<p>When the ID is used to identify observations in another table, that is referred to as the <strong>foreign key</strong>. Here, <code>host_id</code> is used to connect <code>l</code> to the <code>h</code> table and as such is a foreign key.</p>
<p>Say we want to know all of the host information associated with each listing we will need to join <code>h</code> to <code>l</code>. In this situations we want to keep all records of listings and only keep the host information when it is relevant. A left join with <code>l</code> as the left hand table and <code>h</code> as the right hand table will provide us with exactly what we need.</p>
<p>To actually perform the join, we will use the function <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> from dplyr. There are three arguments that we need to fulfill: <code>x</code>, <code>y</code>, and <code>by</code>. That is, what table will be on our left and which will be on the right? And, which column(s) will act as the common identifier.</p>
<p>Fulfilling the <code>x</code> and <code>y</code> arguments is straightforward, we simply supply the relevant tibbles. Marking the common identifier is a little bit tricky. <code>by</code> expects a character vector with the name of the common identifier. However, in most cases, the column names will differ by table. To connect them we need to create what is called a named vector.</p>
<p>In general we create a vector with <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> and each element is separated by a comma. If we were to create a vector with the names of our identifier (from left to right) it would look like</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"host_id"</span>, <span class="st">"id"</span><span class="op">)</span>
<span class="co">#&gt; [1] "host_id" "id"</span></code></pre></div>
<p>This is a vector of length 2. We need to create a vector of length 1 where the only element is named. We can name vector elements like <code><a href="https://rdrr.io/r/base/c.html">c("element_name" = "element")</a></code>. For <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> the name of the element is the identifier in the left hand table and the element is the name of identifier in the right hand table. Putting this all together it looks like</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"host_id"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>
<span class="co">#&gt; host_id </span>
<span class="co">#&gt;    "id"</span></code></pre></div>
<p>Now we have all of the pieces that we need and can perform the join.</p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">h</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"host_id"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 x 5</span>
<span class="co">#&gt;   host_id price neighborhood name  n_listings</span>
<span class="co">#&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1    4804   125 East Boston  Frank          5</span>
<span class="co">#&gt; 2    8229   145 Roxbury      Terry          2</span>
<span class="co">#&gt; 3    8229   169 Roxbury      Terry          2</span>
<span class="co">#&gt; 4   26988    99 Downtown     Anne           9</span>
<span class="co">#&gt; 5   26988   150 Downtown     Anne           9</span></code></pre></div>
<p>There are no missing values in this join because each <code>host_id</code> had a counter-part in the host table. Now, say we perform right join but keep our tables exactly where they are. What do you expect this to look like?</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">h</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"host_id"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 7 x 5</span>
<span class="co">#&gt;   host_id price neighborhood name     n_listings</span>
<span class="co">#&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1    4804   125 East Boston  Frank             5</span>
<span class="co">#&gt; 2    8229   145 Roxbury      Terry             2</span>
<span class="co">#&gt; 3    8229   169 Roxbury      Terry             2</span>
<span class="co">#&gt; 4   26988    99 Downtown     Anne              9</span>
<span class="co">#&gt; 5   26988   150 Downtown     Anne              9</span>
<span class="co">#&gt; 6   38997    NA &lt;NA&gt;         Michelle         13</span>
<span class="co">#&gt; 7   23078    NA &lt;NA&gt;         Eric              3</span></code></pre></div>
<p>There are two key differences here. The first is that, since the right hand table has unmatched <code>id</code>s, we should anticipate missing values in the columns from <code>l</code>—<code>price</code> and <code>neighborhood</code>. Moreover, since there are multiple matches in the left hand table, we are returned more than observation per match.</p>
<p>This naturally brings us to the inner join. The inner join will <em>only</em> return row where there are matching observations in <em>both</em> tables.</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">h</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"host_id"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 x 5</span>
<span class="co">#&gt;   host_id price neighborhood name  n_listings</span>
<span class="co">#&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1    4804   125 East Boston  Frank          5</span>
<span class="co">#&gt; 2    8229   145 Roxbury      Terry          2</span>
<span class="co">#&gt; 3    8229   169 Roxbury      Terry          2</span>
<span class="co">#&gt; 4   26988    99 Downtown     Anne           9</span>
<span class="co">#&gt; 5   26988   150 Downtown     Anne           9</span></code></pre></div>
<p>Oftentimes, as with this time, the inner join behaves much like a left or right join where one of the tables has each observation matched. In general I recommend performing left or right joins so we can better keep track of missingness.</p>
<p>The last join to cover is the anti join. The anti join is rather unique and is used to find where there are <em>not</em> matches between two tables. When using an anti join we are returned all observations from x where there are <em>not</em> matches in y. From our previous right join, we know that there are not matches for two of the host ids in <code>h</code>. To find these using a join we can put <code>h</code> in the x position and <code>l</code> in the y position. Note that since we are switching the order of our tibbles we need to rearrange the vector we supplied to <code>by</code>.</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">h</span>, <span class="va">l</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="st">"host_id"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;      id name     n_listings</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1 38997 Michelle         13</span>
<span class="co">#&gt; 2 23078 Eric              3</span></code></pre></div>
<p>If we reverse this, we should receive an empty tibble.</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">h</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"host_id"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 0 x 3</span>
<span class="co">#&gt; # … with 3 variables: host_id &lt;dbl&gt;, price &lt;dbl&gt;, neighborhood &lt;chr&gt;</span></code></pre></div>
<p>Anti joins are often a good way to sanity check your data when looking for completeness or missingness. Be sure to keep this one in your back pocket!</p>
<div id="exercise-2" class="section level2" number="24.1">
<h2>
<span class="header-section-number">24.1</span> Exercise<a class="anchor" aria-label="anchor" href="#exercise-2"><i class="fas fa-link"></i></a>
</h2>
<p>For this exercise your goal is to identify the average price and availability of Airbnb rentals by host. Then plot</p>
<ul>
<li>Load the reviews dataset from {uitk}</li>
<li>Count the total number of reviews by listing, create column <code>n_reviews</code>
</li>
<li>join to listings</li>
<li>join that to host, name it <code>airbnb_full</code>.</li>
</ul>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reviews</span> <span class="op">&lt;-</span> <span class="fu">uitk</span><span class="fu">::</span><span class="va">airbnb_reviews</span>

<span class="va">airbnb_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">reviews</span>, <span class="va">listing_id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_reviews <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">listings</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"listing_id"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">hosts</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"host_id"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">airbnb_full</span><span class="op">)</span>
<span class="co">#&gt; Rows: 2,668</span>
<span class="co">#&gt; Columns: 16</span>
<span class="co">#&gt; $ listing_id       &lt;dbl&gt; 3781, 5506, 6695, 8789, 10730, 10813, 18711, 22195, …</span>
<span class="co">#&gt; $ n_reviews        &lt;int&gt; 2, 26, 30, 2, 4, 35, 9, 11, 23, 21, 3, 20, 10, 15, 1…</span>
<span class="co">#&gt; $ neighborhood     &lt;chr&gt; "East Boston", "Roxbury", "Roxbury", "Downtown", "Do…</span>
<span class="co">#&gt; $ room_type        &lt;chr&gt; "Entire home/apt", "Entire home/apt", "Entire home/a…</span>
<span class="co">#&gt; $ price            &lt;dbl&gt; 125, 145, 169, 99, 150, 179, 154, 115, 148, 275, 95,…</span>
<span class="co">#&gt; $ minimum_nights   &lt;dbl&gt; 28, 3, 3, 91, 91, 91, 29, 1, 2, 2, 6, 3, 2, 2, 2, 5,…</span>
<span class="co">#&gt; $ availability_365 &lt;dbl&gt; 68, 322, 274, 247, 29, 0, 304, 285, 62, 247, 197, 80…</span>
<span class="co">#&gt; $ host_id          &lt;dbl&gt; 4804, 8229, 8229, 26988, 26988, 38997, 71783, 85130,…</span>
<span class="co">#&gt; $ name             &lt;chr&gt; "Frank", "Terry", "Terry", "Anne", "Anne", "Michelle…</span>
<span class="co">#&gt; $ since_year       &lt;dbl&gt; 2008, 2009, 2009, 2009, 2009, 2009, 2010, 2010, 2010…</span>
<span class="co">#&gt; $ since_month      &lt;chr&gt; "12", "02", "02", "07", "07", "09", "01", "02", "02"…</span>
<span class="co">#&gt; $ since_day        &lt;chr&gt; "03", "19", "19", "22", "22", "16", "19", "24", "26"…</span>
<span class="co">#&gt; $ response_rate    &lt;chr&gt; "100%", "100%", "100%", "100%", "100%", "92%", "98%"…</span>
<span class="co">#&gt; $ acceptance_rate  &lt;chr&gt; "50%", "100%", "100%", "84%", "84%", "17%", "98%", "…</span>
<span class="co">#&gt; $ superhost        &lt;dbl&gt; 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0…</span>
<span class="co">#&gt; $ n_listings       &lt;dbl&gt; 5, 2, 2, 9, 9, 13, 40, 7, 4, 1, 1, 1, 5, 5, 1, 1, 2,…</span></code></pre></div>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">host_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">listings</span>, <span class="va">hosts</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"host_id"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">superhost</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg_avail <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">availability_365</span><span class="op">)</span>,
            avg_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,
            avg_min_nights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">minimum_nights</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span></code></pre></div>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="visualization-review.html"><span class="header-section-number">23</span> Visualization Review</a></div>
<div class="next"><a href="statistics.html"><span class="header-section-number">25</span> Statistics</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#multiple-data-sets"><span class="header-section-number">24</span> Multiple data sets</a></li>
<li><a class="nav-link" href="#exercise-2"><span class="header-section-number">24.1</span> Exercise</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Urban Informatics Toolkit</strong>" was written by Josiah Parry. It was last built on 2021-02-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
