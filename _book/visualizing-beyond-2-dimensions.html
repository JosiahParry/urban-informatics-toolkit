<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 21 Visualizing beyond 2-dimensions | Urban Informatics Toolkit</title>
<meta name="author" content="Josiah Parry">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.5.3/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Urban Informatics Toolkit</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome</a></li>
<li class="book-part">Foundations of Urban Informatics</li>
<li><a class="" href="the-utility-and-danger-of-big-data.html"><span class="header-section-number">2</span> The Utility and Danger of Big Data</a></li>
<li><a class="" href="data-in-the-municipal-context.html"><span class="header-section-number">3</span> Data in the municipal context</a></li>
<li><a class="" href="approaches-to-and-schools-of-urban-informatics.html"><span class="header-section-number">4</span> Approaches to and Schools of Urban Informatics</a></li>
<li><a class="" href="ecometrics.html"><span class="header-section-number">5</span> Ecometrics</a></li>
<li class="book-part">Toolkit Foundations</li>
<li><a class="" href="the-basics.html"><span class="header-section-number">6</span> The basics</a></li>
<li><a class="" href="r-as-a-calculator.html"><span class="header-section-number">7</span> R as a calculator</a></li>
<li><a class="" href="reading-data.html"><span class="header-section-number">8</span> Reading data</a></li>
<li><a class="" href="exploratory-visual-analysis.html"><span class="header-section-number">9</span> Exploratory Visual Analysis</a></li>
<li><a class="" href="general-data-manipulation.html"><span class="header-section-number">10</span> General data manipulation</a></li>
<li><a class="" href="thats-too-much-data.html"><span class="header-section-number">11</span> That’s too much data</a></li>
<li><a class="" href="the-pipe.html"><span class="header-section-number">12</span> The pipe %&gt;%</a></li>
<li><a class="" href="creating-new-measures.html"><span class="header-section-number">13</span> Creating new measures</a></li>
<li><a class="" href="data-structures.html"><span class="header-section-number">14</span> Data Structures</a></li>
<li><a class="" href="summary-statistics.html"><span class="header-section-number">15</span> Summary statistics</a></li>
<li><a class="" href="summarizing-the-tidy-way.html"><span class="header-section-number">16</span> Summarizing the tidy way</a></li>
<li><a class="" href="toolkit-review.html"><span class="header-section-number">17</span> Toolkit review</a></li>
<li class="book-part">Vizualization Strategies</li>
<li><a class="" href="layered-i.html"><span class="header-section-number">18</span> Grammar of layered graphics I</a></li>
<li><a class="" href="visualizing-trends-and-relationships.html"><span class="header-section-number">19</span> Visualizing Trends and Relationships</a></li>
<li><a class="" href="grammer-of-layered-graphics-ii.html"><span class="header-section-number">20</span> Grammer of layered graphics II</a></li>
<li><a class="active" href="visualizing-beyond-2-dimensions.html"><span class="header-section-number">21</span> Visualizing beyond 2-dimensions</a></li>
<li><a class="" href="visualizing-through-time.html"><span class="header-section-number">22</span> Visualizing through time</a></li>
<li><a class="" href="visualization-review.html"><span class="header-section-number">23</span> Visualization Review</a></li>
<li class="book-part">Expanding the Toolkit</li>
<li><a class="" href="multiple-data-sets.html"><span class="header-section-number">24</span> Multiple data sets</a></li>
<li><a class="" href="statistics.html"><span class="header-section-number">25</span> Statistics</a></li>
<li><a class="" href="spatial-analysis.html"><span class="header-section-number">26</span> Spatial Analysis</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="visualizing-beyond-2-dimensions" class="section level1" number="21">
<h1>
<span class="header-section-number">21</span> Visualizing beyond 2-dimensions<a class="anchor" aria-label="anchor" href="#visualizing-beyond-2-dimensions"><i class="fas fa-link"></i></a>
</h1>
<p>Over the duration of the last three chapters we have cultivated a fundamental understanding of the grammar of graphics and have discussed how to craft univariate visualizations and explore bivariate relationships. In those graphics we have not gone beyond two-dimensions. We only utilized two aesthetics to map. Howver, there is many more that we can incorporate into our visualizations which will in turn enable us to explore three or for variables at once.</p>
<blockquote>
<p>Note that these will not be 3D, but rather visualize three variables.</p>
</blockquote>
<p>To improve our graphics we will utilize the color, shape, and size aesthetics, as well as faceting. Of course, this begs the question of which aesthetic do I choose? Well, that depends upon what type of data you will be visualizing. Each aesthetic serves different purposes and can be used for a different type of variable.</p>
<p>In general we can use the below mappings:</p>
<ul>
<li>color -&gt; continuous or discrete</li>
<li>shape -&gt; discrete</li>
<li>size -&gt; continuous</li>
</ul>
<div id="color" class="section level2" number="21.1">
<h2>
<span class="header-section-number">21.1</span> Color<a class="anchor" aria-label="anchor" href="#color"><i class="fas fa-link"></i></a>
</h2>
<p>Let us first take a look at the use of color. Color is, after position, the easiest visual cue for we humans to distinguish (that viz book on my coffee table) between. It is also a rather versatile visual cue as it can be used to address both continuous and discrete variables. We will first explore the use of color for discrete measurements. In this context, I do not necessarily mean discrete as in integers, but more or less groups. This is where there is not <em>necessarily</em> an order or scale implied in the data. It <em>can</em> however be indicative of order—think for example age groups. To explore the use of color for groups or discrete data, we will look at Boston ecometrics of social disorder as discussed previously (O’Brien 2015 CITE NEEDED). Ecometrics are stored in the uitk package as the object <code>ecometrics</code></p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">uitk</span><span class="op">)</span>

<span class="va">ecometrics</span>
<span class="co">#&gt; # A tibble: 68 x 4</span>
<span class="co">#&gt;    type                measure   year     n</span>
<span class="co">#&gt;    &lt;chr&gt;               &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 armed robbery       violence  2015   430</span>
<span class="co">#&gt;  2 armed robbery       violence  2016   445</span>
<span class="co">#&gt;  3 armed robbery       violence  2017   413</span>
<span class="co">#&gt;  4 armed robbery       violence  2018   307</span>
<span class="co">#&gt;  5 assault and battery guns      2015   122</span>
<span class="co">#&gt;  6 assault and battery guns      2016   190</span>
<span class="co">#&gt;  7 assault and battery guns      2017   162</span>
<span class="co">#&gt;  8 assault and battery guns      2018   169</span>
<span class="co">#&gt;  9 assault and battery violence  2015  5770</span>
<span class="co">#&gt; 10 assault and battery violence  2016  6021</span>
<span class="co">#&gt; # … with 58 more rows</span></code></pre></div>
<p>At this point in your learning, I think it is appropriate to introduce you to a new package that can be used to quickly summarize and visualize your data. That is called <code>skimr</code>. Within the package there is a function called <code>skim()</code>. This package is really useful for quickly getting an understanding of a dataset as it provides useful summary statistics for each variable as well as a histogram for numeric columns.</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim</a></span><span class="op">(</span><span class="va">ecometrics</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; ── Data Summary ────────────────────────
#&gt;                            Values    
#&gt; Name                       ecometrics
#&gt; Number of rows             68        
#&gt; Number of columns          4         
#&gt; _______________________              
#&gt; Column type frequency:               
#&gt;   character                2         
#&gt;   numeric                  2         
#&gt; ________________________             
#&gt; Group variables            None      
#&gt; 
#&gt; ── Variable type: character ────────────────────────────────────────────────────
#&gt;   skim_variable n_missing complete_rate   min   max empty n_unique whitespace
#&gt; 1 type                  0             1     5    34     0       15          0
#&gt; 2 measure               0             1     4    16     0        4          0
#&gt; 
#&gt; ── Variable type: numeric ──────────────────────────────────────────────────────
#&gt;   skim_variable n_missing complete_rate  mean      sd    p0   p25   p50   p75
#&gt; 1 year                  0             1 2016.    1.13  2015 2016. 2016. 2017.
#&gt; 2 n                     0             1 1929. 1857.      68  786  1230  2690.
#&gt;    p100 hist 
#&gt; 1  2018 ▇▇▁▇▇
#&gt; 2  7392 ▇▂▁▁▁</code></pre>
<p>A simple graphic here would be to evaluate the raw counts by year. A simple bar chart would look like this.</p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">ecometrics</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-6-1.png" width="100%"></div>
<p>But, we are aware that there are different measurements. These were described previously and can be seen below.</p>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">ecometrics</span>, <span class="va">measure</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 x 1</span>
<span class="co">#&gt;   measure         </span>
<span class="co">#&gt;   &lt;chr&gt;           </span>
<span class="co">#&gt; 1 violence        </span>
<span class="co">#&gt; 2 guns            </span>
<span class="co">#&gt; 3 private conflict</span>
<span class="co">#&gt; 4 social disorder</span></code></pre></div>
<p>How can we partition our visualization to illustrate the number of counts per ecometric per year? We can use color—each measurement will receive it’s own color. This will make it easier to determine the frequency of which each ecometric occurs. To do this we setting <code>fill</code> rather than <code>color</code> this is because we are working with a polygon shape. <code>color</code> is used in working with lines and points. A useful trick is to think of <code>color</code> as the border and <code>fill</code> as the body fill.</p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">ecometrics</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">n</span>, fill <span class="op">=</span> <span class="va">measure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-8-1.png" width="100%"></div>
<p>By mapping the fill to the <code>measure</code> variable we were able to create a stacked bar chart! It is apparent that <code>violence</code> is the most frequent of these ecometrics, followed by <code>private conflict</code>, <code>social disorder</code>, and then <code>guns</code>.</p>
<p>One of the downsides about the stacked barchart is that it is difficult to compare the sizes of each group relative to ones that are not adjacent. For example comparing <code>guns</code> to <code>social disorder</code> is made difficult as <code>private conflict</code> is situated between them. We can adjust our chart so that each bar is situated next to eachother. We do this by setting the argument <code>position = "dodge"</code> within the <code>geom_col()</code> layer.</p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">ecometrics</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">n</span>, fill <span class="op">=</span> <span class="va">measure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-9-1.png" width="100%"></div>
<p>The dodged bar chart makes it much easier to compare the heights of each bar. But now we are creating a somewhat cluttered graphic. In the situation where there are multiple groups and subgroups, it is often preferred to utilize facetting because the most important thing in any graphic is how easy it is to consume. We would rather make four plots than one messy plot.</p>
<p>Let’s facet by <code>measure</code> and tell <code>facet_wrap()</code> to create only one row.</p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">ecometrics</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">n</span>, fill <span class="op">=</span> <span class="va">measure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="st">"measure"</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-10-1.png" width="100%"></div>
<p>This is awesome! We have four different plots one for each measurement and it is extremely easy to see how each ecoemtrics has trended over the four year period. It seems like there has been a steady decrease! With this plot, however, we are labeling the ecometrics twice: once with the panel label and once with the legend. Since each facet is labeled individually and are not situated next to any other ecometrics, the color becomes redundant. Unless there is an important reason to visualize the color when faceting, it is most likely not needed. As such, a final visualization would look like below.</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">ecometrics</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="st">"measure"</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-11-1.png" width="100%"></div>
<div id="continuous-color-scales" class="section level3" number="21.1.1">
<h3>
<span class="header-section-number">21.1.1</span> Continuous color scales<a class="anchor" aria-label="anchor" href="#continuous-color-scales"><i class="fas fa-link"></i></a>
</h3>
<p>In the cases where our variable of interest is a continuous numeric one, we ought to be using a continuous color scale. These are scales that change from one color to another to illustrate a range of values—for example we could use this to visualize probabilities from 0 - 1. The below is an example of one of these color palettes.</p>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-12-1.png" width="100%"></div>
<p>Often you’ll encounter visualizations that use a rainbow color palette or some other number of colors. To illustrate a range of values. This is <em>not</em> recommended. When we are looking at color, we are best able to detect changes in the luminescence (perceived brightness) and saturation.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Why should engineers and scientists care about color and design? &lt;em&gt;Flowing Data&lt;/em&gt;. &lt;a href="https://flowingdata.com/2008/04/29/why-should-engineers-and-scientists-care-about-color-and-design/" class="uri"&gt;https://flowingdata.com/2008/04/29/why-should-engineers-and-scientists-care-about-color-and-design/&lt;/a&gt;.&lt;/p&gt;'><sup>66</sup></a> As such, we should work with color palettes that are easiest to interpret. First we’ll visualize what changing saturation and brightness looks like.</p>
<p>Below is is an image of 10 colors. Starting at the left is the color yellow (hex code <code>#FFFF00FF</code>). Each step it is desaturated by 10 percent ending with the color grey (hex code <code>#808080FF</code>). We can think of saturation as how much color there is.</p>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-13-1.png" width="100%"></div>
<p>Below is an example of what changing the brightness can look like.</p>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-14-1.png" width="100%"></div>
<p>If we expand the usage of brightness on both ends of the spectrum we get the below.</p>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-15-1.png" width="100%"></div>
<p>You may find that in the course of your work that individuals will use a color palette like the below.</p>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">prismatic</span><span class="fu">:::</span><span class="fu">plot.colors</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-16-1.png" width="100%"></div>
<p>I strongly <strong>advise against</strong> this. These colors make it extremely difficult to tell changing values. Consider for a moment how you would try and tell the difference in numeric value between a magenta and a maroon. It would be rather difficult. Moreover, this color palette is not very accessible to those who are color deficient. The below is an approximation of what those with varying types of color blindness might see.</p>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-17-1.png" width="100%"></div>
<p>Compare this with the earlier example of dark to light yellows.</p>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-18-1.png" width="100%"></div>
<p>This is much more accessible to those who are color deficient as well as providing a clearer understanding of a <em>range</em> of values.</p>
<div id="example" class="section level4" number="21.1.1.1">
<h4>
<span class="header-section-number">21.1.1.1</span> Example<a class="anchor" aria-label="anchor" href="#example"><i class="fas fa-link"></i></a>
</h4>
<p>To explore this in R, we will return to the commute data set we created from BARI’s Census Indicators very early on. We will visualize the relationship of commuting by automobile and median household income. Moreover, we will color each point by the rate of Bachelor’s degree attainment. As educational attainment tends to increase with income, we should expect the coloring to somewhat follow household income.</p>
<p>Create the visualization following the below steps.</p>
<ul>
<li>Use the object <code>commute</code>
</li>
<li>Plot <code>med_house_income</code> against (on the y axis) <code>by_auto</code>
</li>
<li>Color the plot by <code>bach</code>
</li>
<li>Add the appropriate geometry</li>
</ul>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">commute</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">by_auto</span>, <span class="va">med_house_income</span>, color <span class="op">=</span> <span class="va">bach</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-19-1.png" width="100%"></div>
<p>Wonderful! As anticipated, the color of the points are darkest at the bottom where median household income is the lowest. And as income increases, so does the brightness and saturation of our color scale. If we return to the grammar of graphics, we can take further control of the scales. In this case, the color of the scales. One of the ways we can change the color scale is to add the layer <code>scale_color_gradient()</code> to manually choose what colors to use in our scale. This provides a lot of flexibility to you as a information designer. Think of how you can use the color to represent what it is thatyou are visualizing. Or, how you can use colors to adhere to a color palette of your own or an organization you are working with.</p>
<p><code>scale_color_gradient()</code> allows us to provide the colors for low values and high values. In general, you should choose a darker color to represent lower values and brighter colors for higher values. Below we add the layer and provide color codes.</p>
<blockquote>
<p>You can find color codes via google by searching “color picker.” Or, you can use any number of free color palette generators online. I am personally a fan of <a href="https://coolors.co">coolors.co</a>.</p>
</blockquote>
<p>Below we’ve changed the plot to transition from a dark red to a white as values increase.</p>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu">scale_color_gradient</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"#360002"</span>, high <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-20-1.png" width="100%"></div>
<p>Try modifying the above plot by picking two colors that you think do a good job of visualizing a range of values.</p>
</div>
<div id="diverging-colors" class="section level4" number="21.1.1.2">
<h4>
<span class="header-section-number">21.1.1.2</span> Diverging colors<a class="anchor" aria-label="anchor" href="#diverging-colors"><i class="fas fa-link"></i></a>
</h4>
<p>There are many a time when our variable of interest has a middle value and illustrating the center as well as the deviation from that center is important. To visually represent this we use what is called a diverging color scale. Diverging color scales are characterized by a middle color from which both ends of the spectrum originate. The center is to represent some middle value. If we contextualize this as z-scores and the color palette below, the center would be <code>0</code> and any negative scores would trend towards red. Whereas if they trended positive they would become more blue.</p>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-21-1.png" width="100%"></div>
<p>One thing to be wary of is using a divergent color scale when it is not necessary. This is an easy trap to fall into since they’re pretty cool. Remember, <em>only</em> use diverging color palettes if there is an existing middle value.</p>
</div>
<div id="example-1" class="section level4" number="21.1.1.3">
<h4>
<span class="header-section-number">21.1.1.3</span> Example<a class="anchor" aria-label="anchor" href="#example-1"><i class="fas fa-link"></i></a>
</h4>
<p>Take our ecometrics again. Say we are interested in what the annual deviation is from the sample mean—the average for all years—of each ecometric. This is the perfect use case for a diverging color scale. This will require a bit of computational creativity. So lets work through this.</p>
<p>Let’s think about each of the measures we need to calculate. We need to:</p>
<ul>
<li>Find the number of counts for each year by ecometric.</li>
<li>Find the average count for all years for each ecometric.</li>
<li>Identify the deviation from the mean.</li>
</ul>
<p>We will work through this sequentially. First and foremost we need to calculate the total number of crime reports by ecometric by year. The dataset has more than one observation per year per ecometric. We can see this by running a quick count.</p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">ecometrics</span>, <span class="va">measure</span>, <span class="va">year</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 16 x 3</span>
<span class="co">#&gt;    measure           year     n</span>
<span class="co">#&gt;    &lt;chr&gt;            &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1 guns              2015     5</span>
<span class="co">#&gt;  2 guns              2016     5</span>
<span class="co">#&gt;  3 guns              2017     5</span>
<span class="co">#&gt;  4 guns              2018     5</span>
<span class="co">#&gt;  5 private conflict  2015     4</span>
<span class="co">#&gt;  6 private conflict  2016     4</span>
<span class="co">#&gt;  7 private conflict  2017     4</span>
<span class="co">#&gt;  8 private conflict  2018     4</span>
<span class="co">#&gt;  9 social disorder   2015     3</span>
<span class="co">#&gt; 10 social disorder   2016     3</span>
<span class="co">#&gt; 11 social disorder   2017     3</span>
<span class="co">#&gt; 12 social disorder   2018     3</span>
<span class="co">#&gt; 13 violence          2015     5</span>
<span class="co">#&gt; 14 violence          2016     5</span>
<span class="co">#&gt; 15 violence          2017     5</span>
<span class="co">#&gt; 16 violence          2018     5</span></code></pre></div>
<p>We need to tidy this up and ensure that each row is only one observation—in this case one ecometric per year—with the total count. The logic to accomplish this is to first <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> <em>both</em> <code>measure</code> and <code>year</code> and then sum the <code>n</code> values. As such:</p>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ecometrics</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">measure</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` regrouping output by 'measure' (override with `.groups` argument)</span>
<span class="co">#&gt; # A tibble: 16 x 3</span>
<span class="co">#&gt; # Groups:   measure [4]</span>
<span class="co">#&gt;    measure           year     n</span>
<span class="co">#&gt;    &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 guns              2015  3146</span>
<span class="co">#&gt;  2 guns              2016  3111</span>
<span class="co">#&gt;  3 guns              2017  3190</span>
<span class="co">#&gt;  4 guns              2018  2585</span>
<span class="co">#&gt;  5 private conflict  2015  8063</span>
<span class="co">#&gt;  6 private conflict  2016  7807</span>
<span class="co">#&gt;  7 private conflict  2017  7410</span>
<span class="co">#&gt;  8 private conflict  2018  6592</span>
<span class="co">#&gt;  9 social disorder   2015  5043</span>
<span class="co">#&gt; 10 social disorder   2016  4707</span>
<span class="co">#&gt; 11 social disorder   2017  4876</span>
<span class="co">#&gt; 12 social disorder   2018  4168</span>
<span class="co">#&gt; 13 violence          2015 18621</span>
<span class="co">#&gt; 14 violence          2016 18080</span>
<span class="co">#&gt; 15 violence          2017 17172</span>
<span class="co">#&gt; 16 violence          2018 16630</span></code></pre></div>
<p>One of the dplyr quirks is that after you <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>, one level of grouping is removed. This is because we have already performed our aggregate measure and the last level of grouping is now unit of analysis (a row). Since we are currently grouped at the <code>measure</code> level and each row represent one year we are already ready to calculate the average <code>n</code> value by group. Rather than using <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> as we are used to doing with summary statistics, we will use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> and create a column called <code>avg</code> with the average <code>n</code> value for each group. This is because we want to be able to perform a column-wise operation to subtract the average from each row’s <code>n</code> value.</p>
<p>I continue by creating three new columns. The first is <code>avg</code> which is set to the mean of <code>n</code> by group. Since the resulting value of <code><a href="https://rdrr.io/r/base/mean.html">mean(n)</a></code> is a single value, each observation in the group gets that value. Second, I create a new column called <code>deviation</code> which subtracts the new column we created from the <code>n</code> column. The lastly I created a new column to contain the name of the ecometric as well as the year. This is done to ensure that in the visualization each row can be plotted.</p>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">annual_metrics</span> <span class="op">&lt;-</span> <span class="va">ecometrics</span> <span class="op">%&gt;%</span> 
  <span class="co"># group by measure and year</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">measure</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># find the total n for each measure and year</span>
  <span class="co"># summarise loses the last level of grouping</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    <span class="co"># calculate average `n` by ecometric</span>
    avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,
    <span class="co"># calculate the deviation from the mean </span>
    deviation <span class="op">=</span> <span class="va">n</span> <span class="op">-</span> <span class="va">avg</span>,
    <span class="co"># creating a new column that combines the name of the ecometric and the year</span>
    name <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{measure}: {year}"</span><span class="op">)</span>,
  <span class="op">)</span> </code></pre></div>
<p>I snuck in a new package right there. <code>glue</code> is a package that let’s us incorporate R expressions with plain text. Whatever is inside of the brackets <code>{</code> will be run as an R expression. So since I referenced the columns <code>measure</code> and <code>year</code> as <code>"{measure}: {year}"</code> each value of <code>name</code> will look something like <code>social disorder: 2017</code>.</p>
<p>Now that we have a data frame with all of the values we want to plot, let’s go ahead and do that! We will use a lollipop chart here to do so.</p>
<blockquote>
<p>Remember that <code>geom_lollipop()</code> comes from the <code>ggalt</code> package. We can use the function without loading the whole package by referencing the <code>pkgname::function_name()</code>.</p>
</blockquote>
<p>Within the chart we map <code>devation</code> to the color aesthetic.</p>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">annual_metrics</span>, <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">deviation</span>, x <span class="op">=</span> <span class="va">name</span>, color <span class="op">=</span> <span class="va">deviation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggalt</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggalt/man/geom_lollipop.html">geom_lollipop</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Registered S3 methods overwritten by 'ggalt':</span>
<span class="co">#&gt;   method                  from   </span>
<span class="co">#&gt;   grid.draw.absoluteGrob  ggplot2</span>
<span class="co">#&gt;   grobHeight.absoluteGrob ggplot2</span>
<span class="co">#&gt;   grobWidth.absoluteGrob  ggplot2</span>
<span class="co">#&gt;   grobX.absoluteGrob      ggplot2</span>
<span class="co">#&gt;   grobY.absoluteGrob      ggplot2</span></code></pre></div>
<p><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-25-1.png" width="100%">
The above graphic doesn’t take into account the middle value of <code>0</code>. Because of this, we need to tell ggplot2 that this is a diverging color scale. When we were working with a normal continuous color scale we used <code>scale_color_gradient()</code>. Instead, since we have a middle value, to create the diverging color gradient we use <code>scale_color_gradient2()</code>. This adds two more arguments <code>mid</code> and <code>midpoint</code>. The former is the color of that middle value. The second is what that middle value maps to—defaults to 0, which is fine for our example.</p>
<p>Now if we add the below colors—a red, yellow-ish beige, and a blue—we will have a diverging color scale on the plot!</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> 
  <span class="fu">scale_color_gradient2</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"#A12106"</span>, mid <span class="op">=</span> <span class="st">"#B2CEB7"</span>, high <span class="op">=</span> <span class="st">"#004C76"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-26-1.png" width="100%"></div>
<p>Information design is a seemingly endless field of which we only touched on a very small amount. The R community has put a lot of work into enabling the use of color for visualization purposes. The above images of color palettes were created with the help of the wonderful packages <code>prismatic</code> and <code>paletteer</code></p>
<p>To explore color more check out the packages <a href="https://github.com/EmilHvitfeldt/prismatic"><code>prismatic</code></a> and <a href="https://github.com/EmilHvitfeldt/paletteer"><code>paletteer</code></a> by <a href="https://www.hvitfeldt.me/blog/">Emil Hvitfeld</a>.</p>
</div>
</div>
</div>
<div id="shape-and-size" class="section level2" number="21.2">
<h2>
<span class="header-section-number">21.2</span> Shape and Size<a class="anchor" aria-label="anchor" href="#shape-and-size"><i class="fas fa-link"></i></a>
</h2>
<p>We spent a fair amount of time looking at a number of the ways that color can be used. Color can be used to visualize such a wide variety and as such was deserving of such a long section. Here we will briefly look at the other two aesthetics: shape and color.</p>
<div id="shape" class="section level3" number="21.2.1">
<h3>
<span class="header-section-number">21.2.1</span> Shape<a class="anchor" aria-label="anchor" href="#shape"><i class="fas fa-link"></i></a>
</h3>
<p>Shape is another useful way to visualize groups or categories in our data. In general we should use shape only if color is not an option for us. Variations in shapes can be more difficult to discern—particularly when the number of groups to be visualized reaches beyond ~4. Moreover, shapes, depending on choice and intricacy can become overly distracting and can detract from the visualization as a whole. As a heuristic, do not map both shape and color to the same variable.</p>
<p>To illustrate the use of shape we will use data from Inside Airbnb.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Inside Airbnb. &lt;a href="http://insideairbnb.com/" class="uri"&gt;http://insideairbnb.com/&lt;/a&gt;.:&lt;a href="#fn67" class="footnote-ref" id="fnref67"&gt;&lt;sup&gt;67&lt;/sup&gt;&lt;/a&gt; Big Belly. &lt;a href="https://data.boston.gov/dataset/big-belly-alerts-2014/resource/8fb74119-97b9-4114-b773-ea0a82142d3b" class="uri"&gt;https://data.boston.gov/dataset/big-belly-alerts-2014/resource/8fb74119-97b9-4114-b773-ea0a82142d3b&lt;/a&gt;.&lt;/p&gt;'><sup>67</sup></a> This dataset contains Airbnb listings for Boston as well. The dataset can be found in the object <code>airbnb</code>. We will go into the dataset in more depth in the chapter on spatial analysis.</p>
<p>For this visualization we will read in the dataset, filter it down to just <code>"Back Bay"</code>, and then plot points based on their place in space—aka latitude and longitude. We will also map shape to the <code>room_type</code>. Doing this will show us the spatial distribution of Airbnbs as well as the different kinds.</p>
<blockquote>
<p>Note that while we normally say “latitude and longitude,” they represent the y and x axes respectively. So be sure to put the latitude in the y aesthetic position and <em>not</em> longitude.</p>
</blockquote>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter to backbay</span>
<span class="va">bb</span> <span class="op">&lt;-</span> <span class="va">airbnb</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">neighborhood</span> <span class="op">==</span> <span class="st">"Back Bay"</span><span class="op">)</span> 

<span class="co"># plot the points by shape</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">bb</span>,  <span class="fu">aes</span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, shape <span class="op">=</span> <span class="va">room_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-27-1.png" width="100%"></div>
<p>By changing each point’s shape by their associated room type we can get a somewhat better idea of the spatial distribution by type.</p>
<p>What can we tell from this visualization? It looks like most Airbnbs are overwhelmingly the entire home or apartment. We can infer from this that most Airbnbs _are not_being used as additional revenue for residents. But rather that each Airbnb might be a unit of housing that is no longer available to Boston residents. Could this be increasing demand for housing? Is the rise in Airbnbs creating a shortage of housing and can it be one of the factors behind the rising Boston rents?</p>
<p>The above visualization is good, but lets compare that with the use of color.</p>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-28-1.png" width="100%"></div>
<p>Which do you prefer? Which do you feel does a better job getting this message across? Again, we are delving into the world of design and there is never a <em>correct</em> answer. But sometimes there may be a consensus. So just do your best and ask others for their thoughts on your visualizations.</p>
</div>
<div id="size" class="section level3" number="21.2.2">
<h3>
<span class="header-section-number">21.2.2</span> Size<a class="anchor" aria-label="anchor" href="#size"><i class="fas fa-link"></i></a>
</h3>
<p>Moving onto size. Size is an aesthetic that is one of the hardest for humans to properly distinguish between. Because of this, size should usually be used when comparing observations with large discrepancies between them. Doing this with ggplot is again rather straight forward as here the only difference is, is that we set the aesthetic <code>size</code> to some other column (this must be numeric).</p>
<p>This visualization will use data from Analyze Boston’s legacy database. Analyze Boston has previously released all signals from their Big Belly trashcans for the year of 2014<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://data.boston.gov/dataset/big-belly-alerts-2014/resource/8fb74119-97b9-4114-b773-ea0a82142d3b"&gt;Analyze Boston: Big Belly Alerts 2014&lt;/a&gt;&lt;/p&gt;'><sup>68</sup></a>. In the words of the data dictionary:</p>
<blockquote>
<p>Bigbelly’s contain compactors which crush waste within their waste bins in order to reduce the volume required to store the waste deposited into the Bigbelly. The compactors are able provide an average compaction ratio of 5:1, meaning a Bigbelly can store the equivalent of 150G (gallons) of uncompactedwaste within a standard 30G waste bin. The compactor in a Bigbelly will run when it has detected that waste within the bin has reached a certain level. After a compaction cycle the waste will be crushed to occupy a smaller amount of space within the waste bin. These cycles are repeated as more waste is added to the Bigbelly. After approximately 150G of uncompacted waste has been added to the Bigbelly the compactor will not be able to compress the waste further, this condition is detected and thewaste bin is considered to be full.</p>
</blockquote>
<p>For the sake of example, I have created an aggregate count of signals from all Big Belly receptacles for 2014. This can be found in the object <code>big_belly</code>.</p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">big_belly</span><span class="op">)</span>
<span class="co">#&gt; Rows: 147</span>
<span class="co">#&gt; Columns: 4</span>
<span class="co">#&gt; $ description &lt;chr&gt; "1 North Market Street  (in front of McCormick &amp; Schmicks…</span>
<span class="co">#&gt; $ n           &lt;dbl&gt; 47, 179, 257, 108, 171, 93, 27, 173, 55, 64, 126, 190, 19…</span>
<span class="co">#&gt; $ lat         &lt;dbl&gt; 42.36034, 42.35653, 42.35634, 42.35557, 42.35520, 42.3545…</span>
<span class="co">#&gt; $ long        &lt;dbl&gt; -71.05582, -71.06190, -71.06203, -71.06288, -71.06321, -7…</span></code></pre></div>
<p>Similar to the Airbnb data, we will visualize by latitude and longitude (<code>lat</code> and <code>long</code> respectively) while mapping the <code>size</code> aesthetic to <code>n</code>.</p>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">big_belly</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">long</span>, <span class="va">lat</span>, size <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04d-beyond-2d_files/figure-html/unnamed-chunk-30-1.png" width="100%"></div>

</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="grammer-of-layered-graphics-ii.html"><span class="header-section-number">20</span> Grammer of layered graphics II</a></div>
<div class="next"><a href="visualizing-through-time.html"><span class="header-section-number">22</span> Visualizing through time</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#visualizing-beyond-2-dimensions"><span class="header-section-number">21</span> Visualizing beyond 2-dimensions</a></li>
<li>
<a class="nav-link" href="#color"><span class="header-section-number">21.1</span> Color</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#continuous-color-scales"><span class="header-section-number">21.1.1</span> Continuous color scales</a></li></ul>
</li>
<li>
<a class="nav-link" href="#shape-and-size"><span class="header-section-number">21.2</span> Shape and Size</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#shape"><span class="header-section-number">21.2.1</span> Shape</a></li>
<li><a class="nav-link" href="#size"><span class="header-section-number">21.2.2</span> Size</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Urban Informatics Toolkit</strong>" was written by Josiah Parry. It was last built on 2021-02-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
