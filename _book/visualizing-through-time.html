<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 22 Visualizing through time | Urban Informatics Toolkit</title>
<meta name="author" content="Josiah Parry">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.5.3/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Urban Informatics Toolkit</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome</a></li>
<li class="book-part">Foundations of Urban Informatics</li>
<li><a class="" href="the-utility-and-danger-of-big-data.html"><span class="header-section-number">2</span> The Utility and Danger of Big Data</a></li>
<li><a class="" href="data-in-the-municipal-context.html"><span class="header-section-number">3</span> Data in the municipal context</a></li>
<li><a class="" href="approaches-to-and-schools-of-urban-informatics.html"><span class="header-section-number">4</span> Approaches to and Schools of Urban Informatics</a></li>
<li><a class="" href="ecometrics.html"><span class="header-section-number">5</span> Ecometrics</a></li>
<li class="book-part">Toolkit Foundations</li>
<li><a class="" href="the-basics.html"><span class="header-section-number">6</span> The basics</a></li>
<li><a class="" href="r-as-a-calculator.html"><span class="header-section-number">7</span> R as a calculator</a></li>
<li><a class="" href="reading-data.html"><span class="header-section-number">8</span> Reading data</a></li>
<li><a class="" href="exploratory-visual-analysis.html"><span class="header-section-number">9</span> Exploratory Visual Analysis</a></li>
<li><a class="" href="general-data-manipulation.html"><span class="header-section-number">10</span> General data manipulation</a></li>
<li><a class="" href="thats-too-much-data.html"><span class="header-section-number">11</span> That‚Äôs too much data</a></li>
<li><a class="" href="the-pipe.html"><span class="header-section-number">12</span> The pipe %&gt;%</a></li>
<li><a class="" href="creating-new-measures.html"><span class="header-section-number">13</span> Creating new measures</a></li>
<li><a class="" href="data-structures.html"><span class="header-section-number">14</span> Data Structures</a></li>
<li><a class="" href="summary-statistics.html"><span class="header-section-number">15</span> Summary statistics</a></li>
<li><a class="" href="summarizing-the-tidy-way.html"><span class="header-section-number">16</span> Summarizing the tidy way</a></li>
<li><a class="" href="toolkit-review.html"><span class="header-section-number">17</span> Toolkit review</a></li>
<li class="book-part">Vizualization Strategies</li>
<li><a class="" href="layered-i.html"><span class="header-section-number">18</span> Grammar of layered graphics I</a></li>
<li><a class="" href="visualizing-trends-and-relationships.html"><span class="header-section-number">19</span> Visualizing Trends and Relationships</a></li>
<li><a class="" href="grammer-of-layered-graphics-ii.html"><span class="header-section-number">20</span> Grammer of layered graphics II</a></li>
<li><a class="" href="visualizing-beyond-2-dimensions.html"><span class="header-section-number">21</span> Visualizing beyond 2-dimensions</a></li>
<li><a class="active" href="visualizing-through-time.html"><span class="header-section-number">22</span> Visualizing through time</a></li>
<li><a class="" href="visualization-review.html"><span class="header-section-number">23</span> Visualization Review</a></li>
<li class="book-part">Expanding the Toolkit</li>
<li><a class="" href="multiple-data-sets.html"><span class="header-section-number">24</span> Multiple data sets</a></li>
<li><a class="" href="statistics.html"><span class="header-section-number">25</span> Statistics</a></li>
<li><a class="" href="spatial-analysis.html"><span class="header-section-number">26</span> Spatial Analysis</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="visualizing-through-time" class="section level1" number="22">
<h1>
<span class="header-section-number">22</span> Visualizing through time<a class="anchor" aria-label="anchor" href="#visualizing-through-time"><i class="fas fa-link"></i></a>
</h1>
<p>Throughout this section, one type of visualization has been missing from our repetoire‚Äîthe timeseries plot. This is because time series data is rather cumbersome to work with. Time series are unique because each observation represents some point in time. There is order inherent to the data. Because of this natural ordering of the data it makes the problem a bit trickier. But now that we have the visual tools and principles sorted out, we can apply them to time series data and visualize them as well.</p>
<p>For this section we will work with the 2014 Big Belly data again. Our goal will be to visualize the reports by fullness over the course of the year. In this chapter we will first learn how to work with dates. Then we will use our new skills to aggregate our observations and view them over time. Next, we will discuss traditional methods of time series visualization. And finally we will quickly touch on the use of animation for viewing time-series.</p>
<div id="working-with-dates" class="section level2" number="22.1">
<h2>
<span class="header-section-number">22.1</span> Working with dates<a class="anchor" aria-label="anchor" href="#working-with-dates"><i class="fas fa-link"></i></a>
</h2>
<p>The tibble <code>big_belly_raw</code> contains the data we will work with. Assign <code>big_belly_raw</code> to the tibble <code>big_belly</code> and then preview it with <code><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse()</a></code>.</p>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">uitk</span><span class="op">)</span>

<span class="va">big_belly</span> <span class="op">&lt;-</span> <span class="va">big_belly_raw</span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">big_belly</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 51,440
## Columns: 6
## $ description &lt;chr&gt; "Atlantic &amp; Milk", "1330 Boylston @ Jersey Street", "SE B‚Ä¶
## $ timestamp   &lt;dttm&gt; 2014-01-01 00:41:00, 2014-01-01 01:19:00, 2014-01-01 01:‚Ä¶
## $ fullness    &lt;chr&gt; "YELLOW", "YELLOW", "YELLOW", "RED", "GREEN", "YELLOW", "‚Ä¶
## $ collection  &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, TRUE, FALS‚Ä¶
## $ lat         &lt;dbl&gt; 42.35870, 42.34457, 42.34818, 42.34818, 42.34933, 42.3481‚Ä¶
## $ long        &lt;dbl&gt; -71.05144, -71.09783, -71.09744, -71.09744, -71.07702, -7‚Ä¶</code></pre>
<p>What we can see is that the data are rather large and contains a column with the type <code>&lt;dttm&gt;</code> which is new to us. <code>&lt;dttm&gt;</code> is the way that a tibble represents a column of the type date time.</p>
<blockquote>
<p>Note that the formal class for date time data is <code>POSIXct</code>. Working with date times with any computer is a tricky process.</p>
</blockquote>
<p>Date time objects follow the format of <code>YYYY-MM-DD HH:MM:SS</code> where <code>Y</code> is year, <code>M</code> month, <code>D</code> day, <code>H</code> hours, <code>M</code> minutes, and <code>S</code> seconds.</p>
<p>This begs the question ‚Äúhow can we aggregate based on time?‚Äù The easiest way to do this is to group our observations by some interval. To do this we will solicit the help of the package <a href="https://lubridate.tidyverse.org"><code>lubridate</code></a>. lubridate is part of the tidyverse, but it doesn‚Äôt loadwith the tidyverse. As such, we will have to load the package ourselves.</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></code></pre></div>
<p>The package contains dozens of useful functions for working with dates in R. By no means will we go over each of them.</p>
<blockquote>
<p>To explore all of the functions in a package click on the <code>Packages</code> pane and search for the package you are interested in. Click the hyper link with the package name and then all of the exported functions and objects <em>should</em> be documented there.</p>
</blockquote>
<p>We will, however quickly touch on <code><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd()</a></code>, <code><a href="http://lubridate.tidyverse.org/reference/month.html">month()</a></code>, and <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code>.</p>
<p>The first is not useful in this example since <code>read_csv()</code> already parsed the column as a date time for us, but is important nonetheless. <code><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd()</a></code> will convert a character string into a date object. The letters stand for <em>year</em>, <em>month</em>, and <em>date</em>. This function parses dates in the format of yup, you guessed it, year-month-day. For example:</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2020 01 20"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-01-20"</code></pre>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2020 jan. 20"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-01-20"</code></pre>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"20, january-20"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-01-20"</code></pre>
<p>There are others such as <code><a href="http://lubridate.tidyverse.org/reference/ymd.html">mdy()</a></code> and <code><a href="http://lubridate.tidyverse.org/reference/ymd.html">dmy()</a></code> which you can use to parse dates as well.</p>
<blockquote>
<p>The next time you are trying to parse a date think about the way it is formatted. Does the year precede or follow the month?</p>
</blockquote>
<p>Immediately useful to us is the <code><a href="http://lubridate.tidyverse.org/reference/month.html">month()</a></code> function. This will extract the month component of a given date.</p>
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>The above returned the value of <code>1</code> because January is represented by 1. If we wished to return the full name of the month we set the argument <code>label = TRUE</code>.</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="st">"2020-01-01"</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] Jan
## 12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec</code></pre>
<p>Furthermore, we can tell lubridate to not abbreviate the months by setting <code>abbr = FALSE</code>.</p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="st">"2020-01-01"</span>, label <span class="op">=</span> <span class="cn">TRUE</span>, abbr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] January
## 12 Levels: January &lt; February &lt; March &lt; April &lt; May &lt; June &lt; ... &lt; December</code></pre>
<p>We can use the above function to extract the months from our Big Belly dataset. This will be extremely useful in aggregation. The one limitation, however, is that if there were another year present we would be grouping observations from both years into the the same month bucket. To avoid this, we can use the function <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code>. <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> takes a date object and returns the closest date rounding down to a given unit. This may be best explained through an example. Given the date March 15th, 2020, let us round down to the near units <code>"week"</code>, <code>"month"</code>, and <code>"year"</code>.</p>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create date object</span>
<span class="va">mar_15</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2020-03-15"</span><span class="op">)</span>

<span class="co"># round to week</span>
<span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">mar_15</span>, unit <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-03-15"</code></pre>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># round to month</span>
<span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">mar_15</span>, unit <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-03-01"</code></pre>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># round to year</span>
<span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">mar_15</span>, unit <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-01-01"</code></pre>
<p>With these new tools lets modify our <code>big_belly</code> tibble by creating two new columns <code>month</code> (with the labels) and <code>week</code> using <code><a href="http://lubridate.tidyverse.org/reference/month.html">month()</a></code> and <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> respectively and assign the result to an object called <code>bb</code>.</p>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bb</span> <span class="op">&lt;-</span> <span class="va">big_belly</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    month <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">timestamp</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    week <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">timestamp</span>, unit <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>
  <span class="op">)</span>

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">bb</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 8
##   description timestamp           fullness collection   lat  long month
##   &lt;chr&gt;       &lt;dttm&gt;              &lt;chr&gt;    &lt;lgl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt;
## 1 Atlantic &amp;‚Ä¶ 2014-01-01 00:41:00 YELLOW   FALSE       42.4 -71.1 Jan  
## 2 1330 Boyls‚Ä¶ 2014-01-01 01:19:00 YELLOW   FALSE       42.3 -71.1 Jan  
## 3 SE Brookli‚Ä¶ 2014-01-01 01:32:00 YELLOW   FALSE       42.3 -71.1 Jan  
## 4 SE Brookli‚Ä¶ 2014-01-01 01:34:00 RED      FALSE       42.3 -71.1 Jan  
## 5 Huntington‚Ä¶ 2014-01-01 02:10:00 GREEN    TRUE        42.3 -71.1 Jan  
## # ‚Ä¶ with 1 more variable: week &lt;dttm&gt;</code></pre>
</div>
<div id="standard-visual-approach" class="section level2" number="22.2">
<h2>
<span class="header-section-number">22.2</span> Standard visual approach<a class="anchor" aria-label="anchor" href="#standard-visual-approach"><i class="fas fa-link"></i></a>
</h2>
<p>When we visualize time we need to consider how we humans cognitively and visually perceive time. Time is linear. It follow a path from start to end. Because of this we want to (almost) always plot our time dimension on the horizontal x axis as time proceeds forwards not up or down. Perhaps as a product of these restrictions there are not many variations on how we can visualize time. Two plots reign in time-series: the line and the bar plot.</p>
<p>We can take our <code>bb</code> tibble and create a barchart of the total number of observations per month.</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">month</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04e-through-time_files/figure-html/unnamed-chunk-10-1.png" width="100%"></div>
<p>We can add a few more characters to the above code chunk so we can compare fullness over the months as well.</p>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">month</span>, <span class="va">fullness</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">month</span>, <span class="va">n</span>, fill <span class="op">=</span> <span class="va">fullness</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04e-through-time_files/figure-html/unnamed-chunk-11-1.png" width="100%"></div>
<p>Before we continue, we have to address the elephant in the room. We just made a plot with a legend that makes no sense. <code>GREEN</code> is mapped to red, <code>RED</code> is mapped to green, and <code>YELLOW</code> is mapped to blue. That‚Äôs not good. We can fix this by adding manually mapping the color using one of the scale functions <code>scale_fill_manual(values = c("green", "red", "yellow"))</code>. Now back to the task at hand‚Äîtime series.</p>
<p>The stacked barchart above runs into the same limitations mentioned previously. And given the number of different time groups creating a dodged bar chart will become to cluttered by putting 36 total bars on there. We could consider faceting.</p>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">month</span>, <span class="va">fullness</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">fullness</span>, <span class="va">n</span>, group <span class="op">=</span> <span class="va">month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="st">"month"</span><span class="op">)</span></code></pre></div>
<p><img src="04e-through-time_files/figure-html/unnamed-chunk-12-1.png" width="100%">
This is okay, but again, still too cluttered. In this scenario we should consider the use of a line graph. The line graph is the de facto time series plot. The lines connect points in time. Achieving this with ggplot is rather straight forward. We will put our time dimension on the x axis and add the <code>geom_line()</code> layer. By default <code>geom_line()</code> doesn‚Äôt know what points to connect to each other when there is more than one per x value. So in our case we need to tell ggplot which points to connect by setting the <code>group</code> aesthetic. Since we want to group together the lines by <code>fullness</code> level set <code>group</code> as well as <code>color</code> to <code>fullness</code>. We can step up the plotting game by also</p>
<div class="sourceCode" id="cb275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">month</span>, <span class="va">fullness</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">month</span>, <span class="va">n</span>, group <span class="op">=</span> <span class="va">fullness</span>, color <span class="op">=</span> <span class="va">fullness</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04e-through-time_files/figure-html/unnamed-chunk-13-1.png" width="100%"></div>
<p>We can step up our plotting game by also adding a layer of points on top of the line to accentuate our lines.</p>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">month</span>, <span class="va">fullness</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">month</span>, <span class="va">n</span>, group <span class="op">=</span> <span class="va">fullness</span>, color <span class="op">=</span> <span class="va">fullness</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="04e-through-time_files/figure-html/unnamed-chunk-14-1.png" width="100%">
The three types are graphs are all that you may ever truly need when visualizing time. But sometimes it‚Äôs nice to go over the top and add all of the frills. Often a dynamic visualization may be more persuasive than a static one.For this, we can use animation and the <code>gganimate</code> package.</p>
</div>
<div id="animation-as-time" class="section level2" number="22.3">
<h2>
<span class="header-section-number">22.3</span> Animation as time<a class="anchor" aria-label="anchor" href="#animation-as-time"><i class="fas fa-link"></i></a>
</h2>
<p>In 2008 researchers at Microsoft and a scholar from Georgia Institute of Technology published a paper titled <em>Effectiveness of Animation in Trend Visualization</em><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Effectiveness of Animation in Trend Visualization. &lt;a href="https://www.cc.gatech.edu/~stasko/papers/infovis08-anim.pdf" class="uri"&gt;https://www.cc.gatech.edu/~stasko/papers/infovis08-anim.pdf&lt;/a&gt;.&lt;/p&gt;'><sup>69</sup></a>. This paper explored the reaction to a talk from 2006 which captured the attention of many by using animation to visualize global trends in health. That TED talk by Hans Rosling was a moving utilization of data visualization<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Hans Rosling. &lt;a href="https://www.ted.com/talks/hans_rosling_the_best_stats_you_ve_ever_seen/transcript" class="uri"&gt;https://www.ted.com/talks/hans_rosling_the_best_stats_you_ve_ever_seen/transcript&lt;/a&gt;.&lt;/p&gt;'><sup>70</sup></a>. But why? This paper presented interactive and static visualizations to discover people‚Äôs perspective on animation and its alternatives. They found that</p>
<blockquote>
<p>‚Äúusers really liked the animation view: Study participants described it as‚Äùfun‚Äú,‚Äùexciting‚Äú, and even‚Äùemotionally touching." At the same time, though, some participants found it confusing: ‚Äúthe dots flew everywhere.‚Äù<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Effectiveness of Animation in Trend Visualization. &lt;a href="https://www.cc.gatech.edu/~stasko/papers/infovis08-anim.pdf" class="uri"&gt;https://www.cc.gatech.edu/~stasko/papers/infovis08-anim.pdf&lt;/a&gt;.&lt;/p&gt;'><sup>71</sup></a></p>
</blockquote>
<p>We now have scientific backing that animation is pretty good but also we‚Äôre unsure‚Äîwhich seems to be in line with the rest of science. We will take the above quote as a measure of caution. That we <em>can</em> creaate animations but also be careful with our use of them. For the remainder of this chapter we will learn about the the extension to ggplot2, gganimate. gganimate extends ggplot by extending the grammar to include elements pertaining solely to animation.</p>
<p>When working with gganimate we need to think in the context of <em>frames</em>. Each frame will be a cross-section of our data. Or you can think of each frame a still in our film. In the context of time-series each frame will be our period of time. So if we continue with our Big Belly example above, each frame can be thought of as each month.</p>
<p>To create animations we will need to install four packages: <code>gganimate</code>, <code>gifski</code> (what a brilliant name), <code>png</code>, and <code>transformr</code>. You can do so by running <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages(c("gganimate", "gifski", "png", "transformr"))</a></code>.</p>
<p>For extending ggplot2, gganimate adds three main types of layers to ggplot. There are most importantly the <code>transition_*()</code>s and the <code>enter_*()</code> and <code>exit_*()</code> layers. In this chapter we will only address the <code>transition_*()</code> layers. The transitions will be used to move through our time dimension. For working with time data we will use <code><a href="https://gganimate.com/reference/transition_states.html">transition_states()</a></code> and <code><a href="https://gganimate.com/reference/transition_reveal.html">transition_reveal()</a></code>. These are best used with bar charts and line plot respectively.</p>
<p>Since we will be changing our frames by our time dimension‚Äî<code>month</code> in this case‚Äîwe start building our ggplot without it included. So, to create an animation of the counts by fullness by month we actually just start by visualizing the total counts.</p>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">month</span>, <span class="va">fullness</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">fullness</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="04e-through-time_files/figure-html/unnamed-chunk-15-1.png" width="100%">
All that is needed to add animation to this plot is a transition layer. For the use of a bar chart we can use <code><a href="https://gganimate.com/reference/transition_states.html">transition_states(states)</a></code> where states is the unquoted name of the column that wil be transitioned through.</p>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com">gganimate</a></span><span class="op">)</span>

<span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://gganimate.com/reference/transition_states.html">transition_states</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span>  </code></pre></div>
<div class="inline-figure"><img src="04e-through-time_files/figure-html/unnamed-chunk-16-1.gif" width="100%"></div>
<p>This is awesome! We‚Äôve created an animation üòÆ. The bars change heigh with each change of state. The only bummer is that we don‚Äôt know what states the animation is going through! When the animation is made there are four temporary variables made available for labeling. The documentation for <code><a href="https://gganimate.com/reference/transition_states.html">transition_states()</a></code> notes that the following variables are available<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;code&gt;transition_states()&lt;/code&gt;. &lt;a href="https://gganimate.com/reference/transition_states.html" class="uri"&gt;https://gganimate.com/reference/transition_states.html&lt;/a&gt;.&lt;/p&gt;'><sup>72</sup></a>.</p>
<ul>
<li>
<strong>transitioning</strong> is a boolean indicating whether the frame is part of the transitioning phase</li>
<li>
<strong>previous_state</strong> The name of the last state the animation was at</li>
<li>
<strong>closest_state</strong> The name of the state closest to this frame</li>
<li>
<strong>next_state</strong> The name of the next state the animation will be part of</li>
</ul>
<p>We can add a label layer to make this much more informative. To reference these variables we can use glue like quote strings with the above variables.</p>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> 
  <span class="fu"><a href="https://gganimate.com/reference/transition_states.html">transition_states</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span>  <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"{closest_state}"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04e-through-time_files/figure-html/unnamed-chunk-17-1.gif" width="100%"></div>
<p>This ts the scaffolding for a great visualization. We can take this existing plot and add or adjust the layers to adjust the styling to be more engaging.</p>
<p>We can also add animation to our previous line plot. We can use the <code><a href="https://gganimate.com/reference/transition_reveal.html">transition_reveal()</a></code> layer to reveal changes over time.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="visualizing-through-time.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(bb, month, fullness) <span class="sc">%&gt;%</span> </span>
<span id="cb280-2"><a href="visualizing-through-time.html#cb280-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(month, n, <span class="at">group =</span> fullness, <span class="at">color =</span> fullness)) <span class="sc">+</span></span>
<span id="cb280-3"><a href="visualizing-through-time.html#cb280-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb280-4"><a href="visualizing-through-time.html#cb280-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb280-5"><a href="visualizing-through-time.html#cb280-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_reveal</span>(month)</span>
<span id="cb280-6"><a href="visualizing-through-time.html#cb280-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-7"><a href="visualizing-through-time.html#cb280-7" aria-hidden="true" tabindex="-1"></a>Error<span class="sc">:</span> along data must either be integer, numeric, POSIXct, Date, difftime, orhms</span></code></pre></div>
<p>Note the above error. This is telling us that since our x, or time dimension is actually being treated as a factor, it cannot move along the axis. The error message is informative enough to let us know that we need to change month to a numeric value. As a way to address this but yet maintain the nice labeling on the x axis we can create another column called <code>month_integer</code> which is jsut the integer value of the month‚Äîso Jan is 1 etc. We can provide that value to <code><a href="https://gganimate.com/reference/transition_reveal.html">transition_reveal()</a></code>. Moreover <code><a href="https://gganimate.com/reference/transition_reveal.html">transition_reveal()</a></code> creates the <code>frame_along</code> temporary variable if you‚Äôd so like to use it.</p>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">month</span>, <span class="va">fullness</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month_integer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">month</span>, <span class="va">n</span>, group <span class="op">=</span> <span class="va">fullness</span>, color <span class="op">=</span> <span class="va">fullness</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://gganimate.com/reference/transition_reveal.html">transition_reveal</a></span><span class="op">(</span><span class="va">month_integer</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04e-through-time_files/figure-html/unnamed-chunk-19-1.gif" width="100%"></div>
<p>This animation does a great job of illustrating the changing slopes of the fullness measures.</p>
<p>While it may seem a little underwhelming, these two functions can provide you with most of the functionality you will need for creating animations. Explore the functions in the package to explore how you can add to your animation and make it truly yours.</p>
<blockquote>
<p><code><a href="https://gganimate.com/reference">help(package = "gganimate")</a></code> will bring up all of the help documentation for the package.</p>
</blockquote>
<p>And with that, we can conclude this section. Congratulations!</p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="visualizing-beyond-2-dimensions.html"><span class="header-section-number">21</span> Visualizing beyond 2-dimensions</a></div>
<div class="next"><a href="visualization-review.html"><span class="header-section-number">23</span> Visualization Review</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#visualizing-through-time"><span class="header-section-number">22</span> Visualizing through time</a></li>
<li><a class="nav-link" href="#working-with-dates"><span class="header-section-number">22.1</span> Working with dates</a></li>
<li><a class="nav-link" href="#standard-visual-approach"><span class="header-section-number">22.2</span> Standard visual approach</a></li>
<li><a class="nav-link" href="#animation-as-time"><span class="header-section-number">22.3</span> Animation as time</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Urban Informatics Toolkit</strong>" was written by Josiah Parry. It was last built on 2021-02-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
