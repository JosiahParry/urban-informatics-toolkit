# Visualizing beyond 2-dimensions

```{r, include=FALSE, message=FALSE}
source("common.R")
library(tidyverse)

acs_raw <- read_csv("data/ACS_1317_TRACT.csv")

commute <- select(acs_raw,
       county,
       hs_grad, bach, master,
       starts_with("commute"),
       starts_with("by"),
       med_house_income) %>% 
  filter(county %in% c("SUFFOLK", "NORFOLK", "MIDDLESEX")) %>% 
  mutate(hh_inc_quin = ntile(med_house_income, 5),
         edu_attain = bach + master) %>% 
  select(-bach, -master)
```


Over the duration of the last three chapters we have cultivated a fundamental understanding of the grammar of graphics and have discussed how to craft univariate visualizations and explore bivariate relationships. In those graphics we have not gone beyond two-dimensions. We only utilized two aesthetics to map. Howver, there is many more that we can incorporate into our visualizations which will in turn enable us to explore three or for variables at once.

> Note that these will not be 3D, but rather visualize three variables. 

To improve our graphics we will utilize the color, shape, and size aesthetics, as well as faceting. Of course, this begs the question of which aesthetic do I choose? Well, that depends upon what type of data you will be visualizing. Each aesthetic serves different purposes and can be used for a different type of variable.

In general we can use the below mappings: 

- color -> continuous or discrete
- size -> continuous
- shape -> discrete

## Color

Let us first take a look at the use of color. Color is, after position, the easiest visual cue for we humans to distinguish (that viz book on my coffee table) between. It is also a rather versatile visual cue as it can be used to address both continuous and discrete variables. We will first explore the use of color for discrete measurements. In this context, I do not necessarily mean discrete as in integers, but more or less groups. This is where there is not _necessarily_ an order or scale implied in the data. It _can_ however be indicative of order—think for example age groups. To explore the use of color for groups or discrete data, we will look at Boston ecometrics of social disorder as discussed previously (O'Brien 2015 CITE NEEDED). Ecometrics are stored in a file called `ecometrics.csv` the `data` directory. Read it in as `ecometrics`. 

```{r message=FALSE}
library(tidyverse)

ecometrics <- read_csv("data/ecometrics.csv")
```


At this point in your learning, I think it is appropriate to introduce you to a new package that can be used to quickly summarize and visualize your data. That is called `skimr`. Within the package there is a function called `skim()`. This package is really useful for quickly getting an understanding of a dataset as it provides useful summary statistics for each variable as well as a histogram for numeric columns. 

```{r results='raw', eval=FALSE}
skimr::skim(ecometrics)
```

```{r echo=FALSE}
print(skimr::skim(ecometrics))
```

A simple graphic here would be to evaluate the raw counts by year. A simple bar chart would look like this.

```{r}
ggplot(ecometrics, aes(year, n)) +
  geom_col()
```

But, we are aware that there are different measurements. These were described previously and can be seen below.

```{r}
distinct(ecometrics, measure)
```

How can we partition our visualization to illustrate the number of counts per ecometric per year? We can use color—each measurement will receive it's own color. This will make it easier to determine the frequency of which each ecometric occurs. To do this we setting `fill` rather than `color` this is because we are working with a polygon shape. `color` is used in working with lines and points. A useful trick is to think of `color` as the border and `fill` as the body fill. 

```{r}
ggplot(ecometrics, aes(year, n, fill = measure)) +
  geom_col()
```

By mapping the fill to the `measure` variable we were able to create a stacked bar chart! It is apparent that `violence` is the most frequent of these ecometrics, followed by `private conflict`, `social disorder`, and then `guns`. 

One of the downsides about the stacked barchart is that it is difficult to compare the sizes of each group relative to ones that are not adjacent. For example comparing `guns` to `social disorder` is made difficult as `private conflict` is situated between them. We can adjust our chart so that each bar is situated next to eachother. We do this by setting the argument `position = "dodge"` within the `geom_col()` layer.

```{r}
ggplot(ecometrics, aes(year, n, fill = measure)) +
  geom_col(position = "dodge")
```

The dodged bar chart makes it much easier to compare the heights of each bar. But now we are creating a somewhat cluttered graphic. In the situation where there are multiple groups and subgroups, it is often preferred to utilize facetting because the most important thing in any graphic is how easy it is to consume. We would rather make four plots than one messy plot. 

Let's facet by `measure` and tell `facet_wrap()` to create only one row. 

```{r}
ggplot(ecometrics, aes(year, n, fill = measure)) +
  geom_col() + 
  facet_wrap("measure", nrow = 1)
```


This is awesome! We have four different plots one for each measurement and it is extremely easy to see how each ecoemtrics has trended over the four year period. It seems like there has been a steady decrease! With this plot, however, we are labeling the ecometrics twice: once with the panel label and once with the legend. Since each facet is labeled individually and are not situated next to any other ecometrics, the color becomes redundant. Unless there is an important reason to visualize the color when facetting, it is most likely not needed. As such, a final visualization would look like below.

```{r}
ggplot(ecometrics, aes(year, n)) +
  geom_col() + 
  facet_wrap("measure", nrow = 1)
```



------------

### Notes


- we have year, measure, and n, lets view year on the x and n on the y
  - we now want to know these totals by measure
  - set the `fill` to the `measure`. fill is used for polygons (a col is a rectangle that needs to be filled)
  - by default this shows us a stacked bar chart which is useful
- another way to do this is to change the position of these bars by setting the position argument to `"dodge"` this enables us to compare the heights of the bars more easily
- also, we should always consider creating small multiples, or facetting, rather than adding more to our plots. We want the data to be consumable. Don't feel forced to put everything on to one graphic

- Continuous use of color.
  - there are two general ways in which continuous variables will be mapped to color. this is if there is a low value and a high value.
  - secondly, we can think of a divergent color palette. This is used when there is a known middle value
    - a common mistake is using a divergent palette when there is no natural middle. be wary of this. 
    
    
- shape is only good when the magnitudes are very different
 
```{r message = FALSE}
# commute <- read_csv("data/acs_edu.csv")
# 
# commute
```
 
 
 



```{r}
# # viewing by fill
# ggplot(ecometrics, aes(year, n, fill = measure)) +
#   geom_col()
# 
# 
# # viewing by fill
# ggplot(ecometrics, aes(year, n, fill = measure)) +
#   geom_col()
# 
# # viewing by fill and dodging
# ggplot(ecometrics, aes(year, n, fill = measure)) +
#   geom_col(position = "dodge")
# 
# # faceting 
# ggplot(ecometrics, aes(year, n)) +
#   geom_col() + 
#   facet_wrap("measure", nrow = 1)


```


we can utilize color, size, and shape to tell a better story with our graphics. 
Each aesthetic can serve a different purpose / used for a different kind of variable

others:
- linetype 

To cover:

- coloring / filling
- shaping
- sizing
- faceting

## Expanding bivariate visualizations to trivariate & other tri-variate


- we can visualize other vcariables by setting further aesthetics.
  - can set the color or fill, size, and shape
- we alreay did this previously when we set the color, let's do that here. 
  - lets see how commuting by walking changes with the family house and under 18 pop
    - set the color argument of the `aes()` function as `color = by_walk`
      - it's important you do this within the aesthetics function 
    
```{r}
# ggplot(acs_raw, aes(fam_house_per, age_u18, color = by_auto)) +
#   geom_point()
```

- we can add size to this as well by setting the `size` aesthetic
  - lets see if the more female headed house holds there are affects commuting by car as minors increases

```{r}
# ggplot(acs_raw, aes(fam_house_per, age_u18, color = by_auto, size = fem_head_per)) +
#   geom_point(alpha = .2)
```

- from this chart we can see quite a few things:
  - as `fam_house_per` increases so does the under 18 pop,
  - as both `age_u18` and `fam_house_per` increase so does the rate of communiting by car
  - as both `age_u18` and `fam_house_per` so does female headed houses, but to a lesser degree
  - this gives us a good idea of some relationships that we can test with our data at a later point

```{r}
# minors_lm <- lm(age_u18 ~ fam_house_per + by_auto + fem_head_per, data = acs_raw)
# 
# huxtable::huxreg(minors_lm)
```



Trivariate:

- grouped / stacked bar charts
- heatmaps 


Color Ramps:

- diverging when there is a true middle
- dark is low bright is high


- most data analyses start with a visualization. 
- the data we have will dictate the type of visualizations we create
- there are many many different ways in which data can be represented
- generally these can be bucketed into a few major categories
  - numeric 
    - integer
    - double
  - character 
    - think groups, factors, nominal, anything that doesn't have a numeric value that makes sense to count, aggregate, etc.
  - time / order 
  
-------


Notes:

https://extremepresentation.typepad.com/files/choosing-a-good-chart-09.pdf